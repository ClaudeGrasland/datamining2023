<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Claude Grasland">

<title>DataMining2023 - Introduction aux API</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">DataMining2023</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./10-API-INTRO.html" aria-current="page">Introduction aux API</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./11-API-OPENDATASOFT.html">L’API opendatasoft</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./12-API-INSEE.html">L’API INSEE</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./20-CARTO-INTRO.html">CARTO-Intro</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./21-CARTO-sf.html">CARTO-sf</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./22-CARTO-mapsf.html">CARTO-mapsf</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#définition" id="toc-définition" class="nav-link" data-scroll-target="#définition">Définition</a></li>
  <li><a href="#fonctions" id="toc-fonctions" class="nav-link" data-scroll-target="#fonctions">Fonctions</a></li>
  <li><a href="#protocoles" id="toc-protocoles" class="nav-link" data-scroll-target="#protocoles">Protocoles</a></li>
  <li><a href="#api-et-data-science" id="toc-api-et-data-science" class="nav-link" data-scroll-target="#api-et-data-science">API et Data Science</a></li>
  </ul></li>
  <li><a href="#lapi-de-la-nasa" id="toc-lapi-de-la-nasa" class="nav-link" data-scroll-target="#lapi-de-la-nasa">l’API de la NASA</a>
  <ul class="collapse">
  <li><a href="#installer-les-packages-jsonlite-et-httr" id="toc-installer-les-packages-jsonlite-et-httr" class="nav-link" data-scroll-target="#installer-les-packages-jsonlite-et-httr">Installer les packages jsonlite et httr</a></li>
  <li><a href="#formulation-dune-requête-get" id="toc-formulation-dune-requête-get" class="nav-link" data-scroll-target="#formulation-dune-requête-get">Formulation d’une requête GET()</a></li>
  <li><a href="#remarque-sur-les-listes" id="toc-remarque-sur-les-listes" class="nav-link" data-scroll-target="#remarque-sur-les-listes">Remarque sur les listes</a></li>
  <li><a href="#extraction-des-données" id="toc-extraction-des-données" class="nav-link" data-scroll-target="#extraction-des-données">Extraction des données</a></li>
  <li><a href="#ecriture-dune-fonction" id="toc-ecriture-dune-fonction" class="nav-link" data-scroll-target="#ecriture-dune-fonction">Ecriture d’une fonction</a></li>
  <li><a href="#api-et-mise-à-jour-en-temps-réel" id="toc-api-et-mise-à-jour-en-temps-réel" class="nav-link" data-scroll-target="#api-et-mise-à-jour-en-temps-réel">API et mise à jour en temps réel</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction aux API</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Claude Grasland </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr,<span class="at">warn.conflicts =</span> T,<span class="at">quietly =</span> T)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr, <span class="at">warn.conflicts =</span> T,<span class="at">quietly =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Les objets suivants sont masqués depuis 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Les objets suivants sont masqués depuis 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="img/API.jpeg" class="img-fluid" width="340"></p>
</div>
</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<section id="définition" class="level3">
<h3 class="anchored" data-anchor-id="définition">Définition</h3>
<p>On peut partir de la définition suivante</p>
<blockquote class="blockquote">
<p>En informatique, API est l’acronyme d’<em>Application Programming Interface</em>, que l’on traduit en français par <strong>interface de programmation applicative</strong> ou <strong>interface de programmation d’application</strong>. L’API peut être résumée à une solution informatique qui permet à des applications de communiquer entre elles et de s’échanger mutuellement des services ou des données. Il s’agit en réalité d’un ensemble de fonctions qui facilitent, via un langage de programmation, l’accès aux services d’une application. (Source : <a href="https://www.journaldunet.fr/web-tech/dictionnaire-du-webmastering/1203559-api-application-programming-interface-definition-traduction/">Journal du Net</a>)</p>
</blockquote>
</section>
<section id="fonctions" class="level3">
<h3 class="anchored" data-anchor-id="fonctions">Fonctions</h3>
<p>Une API peut remplir des fonctions très diverses :</p>
<blockquote class="blockquote">
<p>Dans le domaine d’internet, l’API permet aux développeurs de pouvoir utiliser un programme sans avoir à se soucier du fonctionnement complexe d’une application. Les API peuvent par exemple être utilisées pour déclencher des campagnes publicitaires d’e-mailing de façon automatique sans avoir à passer par la compréhension d’une telle application (c’est le cas avec l’API AdWords de Google, par exemple). On les retrouve aujourd’hui dans de nombreux logiciels, en particulier dans les systèmes d’exploitation, les serveurs d’applications, dans le monde du graphisme (OpenGL), dans les applications SaaS (Office 365, G Suite, Salesforce…), les bases de données, l’open data, etc.(Source : <a href="https://www.journaldunet.fr/web-tech/dictionnaire-du-webmastering/1203559-api-application-programming-interface-definition-traduction/">Journal du Net</a>)</p>
</blockquote>
</section>
<section id="protocoles" class="level3">
<h3 class="anchored" data-anchor-id="protocoles">Protocoles</h3>
<p>D’une manière générale, les API supposent un échange d’informations entre un <em>client</em> et un <em>serveur</em>.</p>
<blockquote class="blockquote">
<p>Ces échanges d’informations suivent un <em>protocole</em> c’est-à-dire un ensemble de règles. Il existe deux grands protocoles de communication sur lesquels s’adossent les API : Simple Object Access Protocol (SOAP) et Representational State Transfer (REST). Le second s’est désormais largement imposé face au premier car il est plus flexible. Il a donné naissance aux API dites REST ou RESTful (Source : <a href="https://www.journaldunet.fr/web-tech/dictionnaire-du-webmastering/1203559-api-application-programming-interface-definition-traduction/">Journal du Net</a>)</p>
</blockquote>
</section>
<section id="api-et-data-science" class="level3">
<h3 class="anchored" data-anchor-id="api-et-data-science">API et Data Science</h3>
<p>Le métier de data analyst implique presque nécessairement l’emploi d’API. Les langages de programmation R ou Python ont donc l’un comme l’autre mis au point des packages pour faciliter l’envoi de requêtes sur des serveurs dotés d’API.</p>
<blockquote class="blockquote">
<p>«API» est un terme général désignant le lieu où un programme informatique interagit avec un autre ou avec lui-même. Dans ce didacticiel, nous travaillerons spécifiquement avec des API Web, où deux ordinateurs différents - un client et un serveur - interagiront l’un avec l’autre pour demander et fournir des données, respectivement.</p>
</blockquote>
<blockquote class="blockquote">
<p>Les API offrent aux scientifiques des données un moyen raffiné de demander des données propres et organisées à partir d’un site Web. Lorsqu’un site Web comme Facebook met en place une API, il met essentiellement en place un ordinateur qui attend les demandes de données.</p>
</blockquote>
<blockquote class="blockquote">
<p>Une fois que cet ordinateur reçoit une demande de données, il effectuera son propre traitement des données et les enverra à l’ordinateur qui l’a demandé. De notre point de vue en tant que demandeur, nous devrons écrire du code dans R qui crée la demande et indique à l’ordinateur exécutant l’API ce dont nous avons besoin. Cet ordinateur lira ensuite notre code, traitera la requête et renverra des données bien formatées qui peuvent être facilement analysées par les bibliothèques R existantes.</p>
</blockquote>
<blockquote class="blockquote">
<p>Pourquoi est-ce précieux? Comparez l’approche API au scraping Web pur. Lorsqu’un programmeur gratte une page Web, il reçoit les données dans un morceau de HTML désordonné. Bien qu’il existe certainement des bibliothèques qui facilitent l’analyse du texte HTML, ce sont toutes des étapes de nettoyage qui doivent être prises avant même de mettre la main sur les données que nous voulons!</p>
</blockquote>
<blockquote class="blockquote">
<p>Souvent, nous pouvons immédiatement utiliser les données que nous obtenons d’une API, ce qui nous fait gagner du temps et de la frustration.</p>
</blockquote>
<p>Source : Traduction française d’un billet de <a href="https://www.dataquest.io/blog/r-api-tutorial/">Pascual C., 2020</a></p>
</section>
</section>
<section id="lapi-de-la-nasa" class="level2">
<h2 class="anchored" data-anchor-id="lapi-de-la-nasa">l’API de la NASA</h2>
<p>A titre d’exemple, C. Pascual propose de travailler avec l’<strong>API Open Notify</strong>, qui donne accès à des données sur divers projets de la NASA. À l’aide de l’API Open Notify, nous pouvons notamment en savoir plus sur l’emplacement de la Station spatiale internationale et sur le nombre de personnes actuellement dans l’espace.</p>
<section id="installer-les-packages-jsonlite-et-httr" class="level3">
<h3 class="anchored" data-anchor-id="installer-les-packages-jsonlite-et-httr">Installer les packages jsonlite et httr</h3>
<p>Pour travailler avec des API dans R, nous devons intégrer certaines bibliothèques (<em>library</em>). Ces bibliothèques prennent toutes les complexités d’une requête d’API et les enveloppent dans des fonctions que nous pouvons utiliser dans des lignes de code uniques. Les bibliothèques R que nous utiliserons sont <code>httr</code> et <code>jsonlite</code>. Elles remplissent des rôles différents dans notre introduction des API, mais les deux sont essentiels.Si vous ne disposez pas de ces bibliothèques dans votre console R ou RStudio, vous devez d’abord les télécharger.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="formulation-dune-requête-get" class="level3">
<h3 class="anchored" data-anchor-id="formulation-dune-requête-get">Formulation d’une requête GET()</h3>
<p>Une requête adressé à une API va suivre le schéma suivant :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"img/API_GET.png"</span>,)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="img/API_GET.png" class="img-fluid" width="226"></p>
</div>
</div>
<p>Il existe plusieurs types de requêtes que l’on peut adresser à un serveur API. Pour nos besoins, nous allons simplement demander des données, ce qui correspond à une demande <strong>GET</strong>. Les autres types de requêtes sont POST et PUT, mais nous n’avons pas à nous en préoccuper dans l’immédiat</p>
<p>Afin de créer une requête GET, nous devons utiliser la fonction <em>GET()</em> de la bibliothèque <code>httr</code>. La fonction GET() nécessite une URL, qui spécifie l’adresse du serveur auquel la demande doit être envoyée.</p>
<p>Notre programme télécharge les données disponibles à l’adresse du serveur et les stocke dans un objet auquel on peut donner le nom que l’on souhaite, par exemple <em>ovni</em> dans la mesure où le résultat est de prime abord assez mystérieux…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ovni <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">"http://api.open-notify.org/astros.json"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(ovni)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "response"</code></pre>
</div>
</div>
<p>On sait que la classe de l’objet est de type <code>response</code> ce qui ne nous avance pas beaucoup.</p>
<p>Toutefois, si on demande à l’objet de s’afficher il nous apporte quatre renseignements utiles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ovni</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Response [http://api.open-notify.org/astros.json]
  Date: 2023-03-17 16:53
  Status: 200
  Content-Type: application/json
  Size: 500 B</code></pre>
</div>
</div>
<ul>
<li><strong>Date</strong> : le moment exact du téléchargement, très utile pour suivre les mises à jour</li>
<li><strong>Status</strong> : le code informatique de résultat de la requête. La valeur <em>200</em> indique un succès alors que les autres valeurs signaleront un problème.</li>
<li><strong>Content-Type</strong> : le type d’information recueillie. Ici, une application au format json</li>
<li><strong>Size</strong> : la taille du fichier résultant du transfert.</li>
</ul>
<p>On poursuit notre enquête en tapant la commande <em>str()</em> qui permet d’avoir plus de détail sur le contenu de l’objet.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ovni)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 10
 $ url        : chr "http://api.open-notify.org/astros.json"
 $ status_code: int 200
 $ headers    :List of 6
  ..$ server                     : chr "nginx/1.10.3"
  ..$ date                       : chr "Fri, 17 Mar 2023 16:53:33 GMT"
  ..$ content-type               : chr "application/json"
  ..$ content-length             : chr "500"
  ..$ connection                 : chr "keep-alive"
  ..$ access-control-allow-origin: chr "*"
  ..- attr(*, "class")= chr [1:2] "insensitive" "list"
 $ all_headers:List of 1
  ..$ :List of 3
  .. ..$ status : int 200
  .. ..$ version: chr "HTTP/1.1"
  .. ..$ headers:List of 6
  .. .. ..$ server                     : chr "nginx/1.10.3"
  .. .. ..$ date                       : chr "Fri, 17 Mar 2023 16:53:33 GMT"
  .. .. ..$ content-type               : chr "application/json"
  .. .. ..$ content-length             : chr "500"
  .. .. ..$ connection                 : chr "keep-alive"
  .. .. ..$ access-control-allow-origin: chr "*"
  .. .. ..- attr(*, "class")= chr [1:2] "insensitive" "list"
 $ cookies    :'data.frame':    0 obs. of  7 variables:
  ..$ domain    : logi(0) 
  ..$ flag      : logi(0) 
  ..$ path      : logi(0) 
  ..$ secure    : logi(0) 
  ..$ expiration: 'POSIXct' num(0) 
  ..$ name      : logi(0) 
  ..$ value     : logi(0) 
 $ content    : raw [1:500] 7b 22 6d 65 ...
 $ date       : POSIXct[1:1], format: "2023-03-17 16:53:33"
 $ times      : Named num [1:6] 0 0.00291 0.15292 0.15311 0.30212 ...
  ..- attr(*, "names")= chr [1:6] "redirect" "namelookup" "connect" "pretransfer" ...
 $ request    :List of 7
  ..$ method    : chr "GET"
  ..$ url       : chr "http://api.open-notify.org/astros.json"
  ..$ headers   : Named chr "application/json, text/xml, application/xml, */*"
  .. ..- attr(*, "names")= chr "Accept"
  ..$ fields    : NULL
  ..$ options   :List of 2
  .. ..$ useragent: chr "libcurl/7.64.1 r-curl/4.3.2 httr/1.4.3"
  .. ..$ httpget  : logi TRUE
  ..$ auth_token: NULL
  ..$ output    : list()
  .. ..- attr(*, "class")= chr [1:2] "write_memory" "write_function"
  ..- attr(*, "class")= chr "request"
 $ handle     :Class 'curl_handle' &lt;externalptr&gt; 
 - attr(*, "class")= chr "response"</code></pre>
</div>
</div>
<p>Nous savons désormais que notre objet ovni est une <strong>liste</strong> comportant 10 branches, elles-mêmes divisées en sous branches qui peuvent être elles-même des listes…</p>
</section>
<section id="remarque-sur-les-listes" class="level3">
<h3 class="anchored" data-anchor-id="remarque-sur-les-listes">Remarque sur les listes</h3>
<p>Les listes sont des objets complexes mais fondamentaux pour la programmation en R. On peut accèder aux branches d’une liste soit en utilisant une série de <code>$</code> soit en se servant de doubles crochets <code>[[ ]]</code>. Par exemple, si on veut accèder à la date de la réponse on peut taper au choix :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ovni<span class="sc">$</span>headers<span class="sc">$</span>date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Fri, 17 Mar 2023 16:53:33 GMT"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ovni[[<span class="st">"headers"</span>]][[<span class="st">"date"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Fri, 17 Mar 2023 16:53:33 GMT"</code></pre>
</div>
</div>
<p>On peut également afficher les noms des branches en partant de la racine puis en suivant l’arbre à l’aide de l’instruction <code>names()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ovni<span class="sc">$</span>headers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "server"                      "date"                       
[3] "content-type"                "content-length"             
[5] "connection"                  "access-control-allow-origin"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ovni<span class="sc">$</span>fields)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
</section>
<section id="extraction-des-données" class="level3">
<h3 class="anchored" data-anchor-id="extraction-des-données">Extraction des données</h3>
<p>Les données contenues dans la réponse ont été stockées au format <em>JSON (JavaScript Object Notation)</em> qui est devenu un standard pour les échanges de données. Mais elles ont été ensuite comprimées en format binaire pour limiter la taille du fichier transféré. Il va donc falloir procéder en quatre étapes pour les extraire</p>
<section id="étape-1-récupérer-les-données-au-format-binaire" class="level4">
<h4 class="anchored" data-anchor-id="étape-1-récupérer-les-données-au-format-binaire">étape 1 : récupérer les données au format binaire</h4>
<p>On extrait le champ de données dans la liste. Le résultat est assez étrange :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>don_bin<span class="ot">&lt;-</span>ovni<span class="sc">$</span>content</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>don_bin</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 7b 22 6d 65 73 73 61 67 65 22 3a 20 22 73 75 63 63 65 73 73 22 2c 20 22 6e
 [26] 75 6d 62 65 72 22 3a 20 31 30 2c 20 22 70 65 6f 70 6c 65 22 3a 20 5b 7b 22
 [51] 63 72 61 66 74 22 3a 20 22 49 53 53 22 2c 20 22 6e 61 6d 65 22 3a 20 22 53
 [76] 65 72 67 65 79 20 50 72 6f 6b 6f 70 79 65 76 22 7d 2c 20 7b 22 63 72 61 66
[101] 74 22 3a 20 22 49 53 53 22 2c 20 22 6e 61 6d 65 22 3a 20 22 44 6d 69 74 72
[126] 79 20 50 65 74 65 6c 69 6e 22 7d 2c 20 7b 22 63 72 61 66 74 22 3a 20 22 49
[151] 53 53 22 2c 20 22 6e 61 6d 65 22 3a 20 22 46 72 61 6e 6b 20 52 75 62 69 6f
[176] 22 7d 2c 20 7b 22 63 72 61 66 74 22 3a 20 22 53 68 65 6e 7a 68 6f 75 20 31
[201] 35 22 2c 20 22 6e 61 6d 65 22 3a 20 22 46 65 69 20 4a 75 6e 6c 6f 6e 67 22
[226] 7d 2c 20 7b 22 63 72 61 66 74 22 3a 20 22 53 68 65 6e 7a 68 6f 75 20 31 35
[251] 22 2c 20 22 6e 61 6d 65 22 3a 20 22 44 65 6e 67 20 51 69 6e 67 6d 69 6e 67
[276] 22 7d 2c 20 7b 22 63 72 61 66 74 22 3a 20 22 53 68 65 6e 7a 68 6f 75 20 31
[301] 35 22 2c 20 22 6e 61 6d 65 22 3a 20 22 5a 68 61 6e 67 20 4c 75 22 7d 2c 20
[326] 7b 22 63 72 61 66 74 22 3a 20 22 49 53 53 22 2c 20 22 6e 61 6d 65 22 3a 20
[351] 22 53 74 65 70 68 65 6e 20 42 6f 77 65 6e 22 7d 2c 20 7b 22 63 72 61 66 74
[376] 22 3a 20 22 49 53 53 22 2c 20 22 6e 61 6d 65 22 3a 20 22 57 61 72 72 65 6e
[401] 20 48 6f 62 75 72 67 22 7d 2c 20 7b 22 63 72 61 66 74 22 3a 20 22 49 53 53
[426] 22 2c 20 22 6e 61 6d 65 22 3a 20 22 53 75 6c 74 61 6e 20 41 6c 6e 65 79 61
[451] 64 69 22 7d 2c 20 7b 22 63 72 61 66 74 22 3a 20 22 49 53 53 22 2c 20 22 6e
[476] 61 6d 65 22 3a 20 22 41 6e 64 72 65 79 20 46 65 64 79 61 65 76 22 7d 5d 7d</code></pre>
</div>
</div>
</section>
<section id="étape-2-convertir-les-données-binaires-au-format-caractère" class="level4">
<h4 class="anchored" data-anchor-id="étape-2-convertir-les-données-binaires-au-format-caractère">étape 2 : convertir les données binaires au format caractère</h4>
<p>La conversion est effectuée à l’aide de la fonction <code>rawToChar()</code> qui fait partie de R-Base.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># conversion du contenu de toto en mode character</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>don_car<span class="ot">&lt;-</span><span class="fu">rawToChar</span>(don_bin)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>don_car</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "{\"message\": \"success\", \"number\": 10, \"people\": [{\"craft\": \"ISS\", \"name\": \"Sergey Prokopyev\"}, {\"craft\": \"ISS\", \"name\": \"Dmitry Petelin\"}, {\"craft\": \"ISS\", \"name\": \"Frank Rubio\"}, {\"craft\": \"Shenzhou 15\", \"name\": \"Fei Junlong\"}, {\"craft\": \"Shenzhou 15\", \"name\": \"Deng Qingming\"}, {\"craft\": \"Shenzhou 15\", \"name\": \"Zhang Lu\"}, {\"craft\": \"ISS\", \"name\": \"Stephen Bowen\"}, {\"craft\": \"ISS\", \"name\": \"Warren Hoburg\"}, {\"craft\": \"ISS\", \"name\": \"Sultan Alneyadi\"}, {\"craft\": \"ISS\", \"name\": \"Andrey Fedyaev\"}]}"</code></pre>
</div>
</div>
<p>On commence à mieux voir le résultat mais ce n’est pas encore très lisible car il s’agit de données au format JSON</p>
</section>
<section id="étape-3-convertir-les-données-json-en-objet-r" class="level4">
<h4 class="anchored" data-anchor-id="étape-3-convertir-les-données-json-en-objet-r">étape 3 : convertir les données JSON en objet R</h4>
<p>On convertit les données de type JSON en données utilisables par R à l’aide de la fonction <em>fromJson()</em> du package <code>jsonlite()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>don_R <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(don_car)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(don_R)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 3
 $ message: chr "success"
 $ number : int 10
 $ people :'data.frame':    10 obs. of  2 variables:
  ..$ craft: chr [1:10] "ISS" "ISS" "ISS" "Shenzhou 15" ...
  ..$ name : chr [1:10] "Sergey Prokopyev" "Dmitry Petelin" "Frank Rubio" "Fei Junlong" ...</code></pre>
</div>
</div>
<p>On obtient finalement une liste de trois éléments dont le dernier est un <em>data.frame</em> décrivant les astronautes présents dans la station spatiale internationale au moment de l’execution du programme.</p>
</section>
<section id="étape-4-récupérer-le-tableau-de-résultats" class="level4">
<h4 class="anchored" data-anchor-id="étape-4-récupérer-le-tableau-de-résultats">étape 4 : Récupérer le tableau de résultats</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>tab<span class="ot">&lt;-</span>don_R<span class="sc">$</span>people</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tab,<span class="at">caption =</span> <span class="st">"Passagers de l'ISS en temps réel"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Passagers de l’ISS en temps réel</caption>
<thead>
<tr class="header">
<th style="text-align: left;">craft</th>
<th style="text-align: left;">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Sergey Prokopyev</td>
</tr>
<tr class="even">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Dmitry Petelin</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Frank Rubio</td>
</tr>
<tr class="even">
<td style="text-align: left;">Shenzhou 15</td>
<td style="text-align: left;">Fei Junlong</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Shenzhou 15</td>
<td style="text-align: left;">Deng Qingming</td>
</tr>
<tr class="even">
<td style="text-align: left;">Shenzhou 15</td>
<td style="text-align: left;">Zhang Lu</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Stephen Bowen</td>
</tr>
<tr class="even">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Warren Hoburg</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Sultan Alneyadi</td>
</tr>
<tr class="even">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Andrey Fedyaev</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="ecriture-dune-fonction" class="level3">
<h3 class="anchored" data-anchor-id="ecriture-dune-fonction">Ecriture d’une fonction</h3>
<p>Une fois que l’on a bien compris la procédure d’extraction de cette API, on peut construire une fonction d’extraction pour simplifier la tâche et l’automatiser :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fonction</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>extract_ISS <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  ovni <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">"http://api.open-notify.org/astros.json"</span>) </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  don_bin<span class="ot">&lt;-</span>ovni<span class="sc">$</span>content</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  don_char<span class="ot">&lt;-</span><span class="fu">rawToChar</span>(don_bin)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  don_R<span class="ot">&lt;-</span><span class="fu">fromJSON</span>(don_char)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  tab<span class="ot">&lt;-</span>don_R<span class="sc">$</span>people</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(tab)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Application</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="fu">extract_ISS</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         craft             name
1          ISS Sergey Prokopyev
2          ISS   Dmitry Petelin
3          ISS      Frank Rubio
4  Shenzhou 15      Fei Junlong
5  Shenzhou 15    Deng Qingming
6  Shenzhou 15         Zhang Lu
7          ISS    Stephen Bowen
8          ISS    Warren Hoburg
9          ISS  Sultan Alneyadi
10         ISS   Andrey Fedyaev</code></pre>
</div>
</div>
<p>On peut améliorer la fonction en lui faisant ajouter un champ qui indique la date à laquelle a été effectué le relevé :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fonction</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>extract_ISS2 <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  ovni <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">"http://api.open-notify.org/astros.json"</span>) </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  don_bin<span class="ot">&lt;-</span>ovni<span class="sc">$</span>content</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  don_char<span class="ot">&lt;-</span><span class="fu">rawToChar</span>(don_bin)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  don_R<span class="ot">&lt;-</span><span class="fu">fromJSON</span>(don_char)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  tab<span class="ot">&lt;-</span>don_R<span class="sc">$</span>people</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  tab<span class="sc">$</span>date<span class="ot">&lt;-</span>ovni<span class="sc">$</span>headers<span class="sc">$</span>date</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(tab)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Application</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="fu">extract_ISS2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         craft             name                          date
1          ISS Sergey Prokopyev Fri, 17 Mar 2023 16:53:34 GMT
2          ISS   Dmitry Petelin Fri, 17 Mar 2023 16:53:34 GMT
3          ISS      Frank Rubio Fri, 17 Mar 2023 16:53:34 GMT
4  Shenzhou 15      Fei Junlong Fri, 17 Mar 2023 16:53:34 GMT
5  Shenzhou 15    Deng Qingming Fri, 17 Mar 2023 16:53:34 GMT
6  Shenzhou 15         Zhang Lu Fri, 17 Mar 2023 16:53:34 GMT
7          ISS    Stephen Bowen Fri, 17 Mar 2023 16:53:34 GMT
8          ISS    Warren Hoburg Fri, 17 Mar 2023 16:53:34 GMT
9          ISS  Sultan Alneyadi Fri, 17 Mar 2023 16:53:34 GMT
10         ISS   Andrey Fedyaev Fri, 17 Mar 2023 16:53:34 GMT</code></pre>
</div>
</div>
<p>Et si on est à l’aise avec les listes, on peut aussi exporter les résultats sous la forme d’une liste plutôt que d’un tableau, ce qui évite de répéter plusieurs fois la date d’extraction des données</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fonction</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>extract_ISS3 <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  ovni <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">"http://api.open-notify.org/astros.json"</span>) </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  don_bin<span class="ot">&lt;-</span>ovni<span class="sc">$</span>content</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  don_char<span class="ot">&lt;-</span><span class="fu">rawToChar</span>(don_bin)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  don_R<span class="ot">&lt;-</span><span class="fu">fromJSON</span>(don_char)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  tab<span class="ot">&lt;-</span>don_R<span class="sc">$</span>people</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  date<span class="ot">&lt;-</span>ovni<span class="sc">$</span>headers<span class="sc">$</span>date</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  result<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="st">"Update"</span> <span class="ot">=</span> date,<span class="st">"Data"</span> <span class="ot">=</span>tab)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Application</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">extract_ISS3</span>()</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(x<span class="sc">$</span>Data, <span class="at">caption=</span><span class="fu">paste</span>(<span class="st">"Passagers de l'ISS :"</span>, x<span class="sc">$</span>Update))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Passagers de l’ISS : Fri, 17 Mar 2023 16:53:34 GMT</caption>
<thead>
<tr class="header">
<th style="text-align: left;">craft</th>
<th style="text-align: left;">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Sergey Prokopyev</td>
</tr>
<tr class="even">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Dmitry Petelin</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Frank Rubio</td>
</tr>
<tr class="even">
<td style="text-align: left;">Shenzhou 15</td>
<td style="text-align: left;">Fei Junlong</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Shenzhou 15</td>
<td style="text-align: left;">Deng Qingming</td>
</tr>
<tr class="even">
<td style="text-align: left;">Shenzhou 15</td>
<td style="text-align: left;">Zhang Lu</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Stephen Bowen</td>
</tr>
<tr class="even">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Warren Hoburg</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Sultan Alneyadi</td>
</tr>
<tr class="even">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Andrey Fedyaev</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="api-et-mise-à-jour-en-temps-réel" class="level3">
<h3 class="anchored" data-anchor-id="api-et-mise-à-jour-en-temps-réel">API et mise à jour en temps réel</h3>
<p>Sur le site web du <a href="https://www.dataquest.io/blog/r-api-tutorial/">billet proposé par C. Pascual en février 2020</a>, on trouve une autre liste ne comportant que 6 passagers et avec des noms totalement différents :</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Passagers de l’ISS en février 2020</caption>
<thead>
<tr class="header">
<th style="text-align: left;">craft</th>
<th style="text-align: left;">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Christina Koch</td>
</tr>
<tr class="even">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Alexander Skvortsov</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Luca Parmitano</td>
</tr>
<tr class="even">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Andrew Morgan</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Oleg Skripochka</td>
</tr>
<tr class="even">
<td style="text-align: left;">ISS</td>
<td style="text-align: left;">Jessica Meir</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>En effet, l’API renvoie les résultats au moment de l’execution de la fonction <em>GET()</em> ce qui correspond à février 2020 pour le billet de blog. Or, les astronautes sont remplacés au plus tous les six mois ce qui explique que tous les noms soient différents un an après.</p>
<p><strong>NB : Cet exemple permet de mettre en évidence une fonction centrale des API qui est la mise à jour en temps réel des données !</strong></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>