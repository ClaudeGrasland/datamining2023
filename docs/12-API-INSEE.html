<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Claude Grasland">

<title>DataMining2023 - L’API INSEE</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">DataMining2023</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./10-API-INTRO.html">Introduction aux API</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./11-API-OPENDATASOFT.html">L’API opendatasoft</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./12-API-INSEE.html" aria-current="page">L’API INSEE</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./20-CARTO-INTRO.html">CARTO-Intro</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./21-CARTO-sf.html">CARTO-sf</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./22-CARTO-mapsf.html">CARTO-mapsf</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#mode-demploi" id="toc-mode-demploi" class="nav-link active" data-scroll-target="#mode-demploi">Mode d’emploi</a>
  <ul class="collapse">
  <li><a href="#chargement-de-la-liste-des-tableaux" id="toc-chargement-de-la-liste-des-tableaux" class="nav-link" data-scroll-target="#chargement-de-la-liste-des-tableaux">Chargement de la liste des tableaux</a></li>
  <li><a href="#examen-des-séries-présentes-dans-un-tableau" id="toc-examen-des-séries-présentes-dans-un-tableau" class="nav-link" data-scroll-target="#examen-des-séries-présentes-dans-un-tableau">Examen des séries présentes dans un tableau</a></li>
  <li><a href="#extraction-dune-série-à-laide-de-son-identifiant" id="toc-extraction-dune-série-à-laide-de-son-identifiant" class="nav-link" data-scroll-target="#extraction-dune-série-à-laide-de-son-identifiant">Extraction d’une série à l’aide de son identifiant</a></li>
  <li><a href="#extraction-dun-ensemble-de-séries-dun-même-tableau" id="toc-extraction-dun-ensemble-de-séries-dun-même-tableau" class="nav-link" data-scroll-target="#extraction-dun-ensemble-de-séries-dun-même-tableau">Extraction d’un ensemble de séries d’un même tableau</a></li>
  <li><a href="#recupération-et-nettoyage-des-données" id="toc-recupération-et-nettoyage-des-données" class="nav-link" data-scroll-target="#recupération-et-nettoyage-des-données">Recupération et nettoyage des données</a></li>
  <li><a href="#construction-dun-graphique" id="toc-construction-dun-graphique" class="nav-link" data-scroll-target="#construction-dun-graphique">Construction d’un graphique</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  </ul></li>
  <li><a href="#exercices" id="toc-exercices" class="nav-link" data-scroll-target="#exercices">Exercices</a>
  <ul class="collapse">
  <li><a href="#exercice-1-utilisation-du-package-insee" id="toc-exercice-1-utilisation-du-package-insee" class="nav-link" data-scroll-target="#exercice-1-utilisation-du-package-insee">Exercice 1 : utilisation du package ‘insee’</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">L’API INSEE</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Claude Grasland </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<p>L’utilisation d’API à l’aide des fonctions de base <code>httpr</code> et <code>jsonlite</code> constitue à moyen terme une étape indispensable de la formation d’un data analyste. Mais heureusement elle n’est pas toujours indispensable pour le débutant car plusieurs packages R (ou Python) ont été développées par des programmeurs pour faciliter l’usage des API.</p>
<p>Ces packages executent en pratique les commandes de l’API, mais sans que l’utilisateur ait besoin d’avoir aucune connaissance sur la syntaxe de la fonction <em>GET()</em> qui a collecté les données ni des transformations effectuées sur les résultats pour transformer les données JSON en <em>data.frame</em> ou <em>tibble</em>. La connaissance de ces packages spécialisées offre donc une grosse économie de temps … s’ils ont été bien conçus.</p>
<p>On va prendre comme exemple le package <code>insee</code> mis au point récemment pour faciliter l’accès aux données de cette organisation. La documentation du package est accessible par le lien ci-dessous</p>
<p>https://pyr-opendatafr.github.io/R-Insee-Data/articles/insee.html</p>
<section id="mode-demploi" class="level2">
<h2 class="anchored" data-anchor-id="mode-demploi">Mode d’emploi</h2>
<p>On commence par installer le package <code>insee</code> ce qui peut prendre quelques minutes mais sera fait une seule fois (sauf mise à jour).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Normal version</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("insee")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">### Development version</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("InseeFr/R-Insee-Data")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut ensuite lancer le package pour l’utiliser avec <em>library()</em> et on ajoute le package <em>tidyverse</em> que l’INSEE semble privilégier pour l’exploitation des données :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(insee)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse,<span class="at">warn.conflicts =</span> F)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="chargement-de-la-liste-des-tableaux" class="level3">
<h3 class="anchored" data-anchor-id="chargement-de-la-liste-des-tableaux">Chargement de la liste des tableaux</h3>
<p>On commence par télécharger le catalogue des tableaux de données disponibles,à l’aide de la commande <em>get_dataset_list()</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>catalogue <span class="ot">=</span> <span class="fu">get_dataset_list</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(catalogue))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 8%">
<col style="width: 35%">
<col style="width: 33%">
<col style="width: 19%">
<col style="width: 3%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: left;">Name.fr</th>
<th style="text-align: left;">Name.en</th>
<th style="text-align: left;">url</th>
<th style="text-align: right;">n_series</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BALANCE-PAIEMENTS</td>
<td style="text-align: left;">Balance des paiements</td>
<td style="text-align: left;">Balance of payments</td>
<td style="text-align: left;">https://www.insee.fr/fr/statistiques/series/103212755</td>
<td style="text-align: right;">197</td>
</tr>
<tr class="even">
<td style="text-align: left;">CHOMAGE-TRIM-NATIONAL</td>
<td style="text-align: left;">Chômage, taux de chômage par sexe et âge (sens BIT)</td>
<td style="text-align: left;">Unemployment, unemployment rate and halo by sex and age (ILO)</td>
<td style="text-align: left;">https://www.insee.fr/fr/statistiques/series/103167923</td>
<td style="text-align: right;">169</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CLIMAT-AFFAIRES</td>
<td style="text-align: left;">Indicateurs synthétiques du climat des affaires</td>
<td style="text-align: left;">Business climate composite indicators</td>
<td style="text-align: left;">https://www.insee.fr/fr/statistiques/series/103047029</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">CNA-2010-CONSO-MEN</td>
<td style="text-align: left;">Consommation des ménages - Résultats par produit, fonction et durabilité</td>
<td style="text-align: left;">Households’ consumption - Results by product, function and durability</td>
<td style="text-align: left;">https://www.insee.fr/fr/statistiques/series/102331845</td>
<td style="text-align: right;">2247</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CNA-2010-CONSO-SI</td>
<td style="text-align: left;">Dépenses de consommation finale par secteur institutionnel - Résultats par opération et produit</td>
<td style="text-align: left;">Final consumption expenditure by institutional sectors - Results by transaction and product</td>
<td style="text-align: left;">https://www.insee.fr/fr/statistiques/series/102809534</td>
<td style="text-align: right;">1391</td>
</tr>
<tr class="even">
<td style="text-align: left;">CNA-2010-CPEB</td>
<td style="text-align: left;">Comptes de production et d’exploitation par branche</td>
<td style="text-align: left;">Production and operating accounts by branch</td>
<td style="text-align: left;">https://www.insee.fr/fr/statistiques/series/102852781</td>
<td style="text-align: right;">2739</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Chaque tableau comporte un très grand nombre de séries chronologiques parmi lesquelles il faut opérer un choix afin d’extraire exactement ce que l’on veut.</p>
</section>
<section id="examen-des-séries-présentes-dans-un-tableau" class="level3">
<h3 class="anchored" data-anchor-id="examen-des-séries-présentes-dans-un-tableau">Examen des séries présentes dans un tableau</h3>
<p>Une fois que l’on a choisi un tableau, on peut examiner plus en détail les différentes séries qui y sont présentes à l’aide de la commande <em>get_idbank_list()</em>. On va par exemple examiner le contenu de la base de données “DECES-MORTALITE” :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>var<span class="ot">&lt;-</span><span class="fu">get_idbank_list</span>(<span class="st">"DECES-MORTALITE"</span>) </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>FALSE tibble [1,905 × 33] (S3: tbl_df/tbl/data.frame)
FALSE  $ nomflow               : chr [1:1905] "DECES-MORTALITE" "DECES-MORTALITE" "DECES-MORTALITE" "DECES-MORTALITE" ...
FALSE  $ idbank                : chr [1:1905] "000067679" "000067680" "000067681" "000436394" ...
FALSE  $ cleFlow               : chr [1:1905] "A.NOMBRE_DECES.VALEUR_ABSOLUE.DECES.FM.0.SO.INDIVIDUS.BRUT.FALSE" "A.TAUX_MORTALITE.TAUX.TXMOR.FM.0.SO.DECES_1000_PERS.BRUT.FALSE" "A.TAUX_MORTALITE.TAUX.TXMORINF.FM.0.SO.P1000.BRUT.FALSE" "M.NOMBRE_DECES.VALEUR_ABSOLUE.DECES.FM.0.SO.INDIVIDUS.BRUT.FALSE" ...
FALSE  $ FREQ                  : chr [1:1905] "A" "A" "A" "M" ...
FALSE  $ INDICATEUR            : chr [1:1905] "NOMBRE_DECES" "TAUX_MORTALITE" "TAUX_MORTALITE" "NOMBRE_DECES" ...
FALSE  $ NATURE                : chr [1:1905] "VALEUR_ABSOLUE" "TAUX" "TAUX" "VALEUR_ABSOLUE" ...
FALSE  $ DEMOGRAPHIE           : chr [1:1905] "DECES" "TXMOR" "TXMORINF" "DECES" ...
FALSE  $ REF_AREA              : chr [1:1905] "FM" "FM" "FM" "FM" ...
FALSE  $ SEXE                  : chr [1:1905] "0" "0" "0" "0" ...
FALSE  $ AGE                   : chr [1:1905] "SO" "SO" "SO" "SO" ...
FALSE  $ UNIT_MEASURE          : chr [1:1905] "INDIVIDUS" "DECES_1000_PERS" "P1000" "INDIVIDUS" ...
FALSE  $ CORRECTION            : chr [1:1905] "BRUT" "BRUT" "BRUT" "BRUT" ...
FALSE  $ SERIE_ARRETEE         : chr [1:1905] "FALSE" "FALSE" "FALSE" "FALSE" ...
FALSE  $ FREQ_label_fr         : chr [1:1905] "Annuelle" "Annuelle" "Annuelle" "Mensuelle" ...
FALSE  $ FREQ_label_en         : chr [1:1905] "Annual" "Annual" "Annual" "Monthly" ...
FALSE  $ INDICATEUR_label_fr   : chr [1:1905] "Nombre de décès" "Taux de mortalité" "Taux de mortalité" "Nombre de décès" ...
FALSE  $ INDICATEUR_label_en   : chr [1:1905] "Number of dead" "Mortality rate" "Mortality rate" "Number of dead" ...
FALSE  $ NATURE_label_fr       : chr [1:1905] "Valeur absolue" "Taux" "Taux" "Valeur absolue" ...
FALSE  $ NATURE_label_en       : chr [1:1905] "Absolute value" "Rate" "Rate" "Absolute value" ...
FALSE  $ DEMOGRAPHIE_label_fr  : chr [1:1905] "Décès de tous âges" "Taux de mortalité" "Taux de mortalité infantile" "Décès de tous âges" ...
FALSE  $ DEMOGRAPHIE_label_en  : chr [1:1905] "Deaths of all ages" "Mortality rate" "Infant mortality rate" "Deaths of all ages" ...
FALSE  $ REF_AREA_label_fr     : chr [1:1905] "France métropolitaine" "France métropolitaine" "France métropolitaine" "France métropolitaine" ...
FALSE  $ REF_AREA_label_en     : chr [1:1905] "Metropolitan France" "Metropolitan France" "Metropolitan France" "Metropolitan France" ...
FALSE  $ SEXE_label_fr         : chr [1:1905] "Ensemble" "Ensemble" "Ensemble" "Ensemble" ...
FALSE  $ SEXE_label_en         : chr [1:1905] "All" "All" "All" "All" ...
FALSE  $ AGE_label_fr          : chr [1:1905] "Sans objet" "Sans objet" "Sans objet" "Sans objet" ...
FALSE  $ AGE_label_en          : chr [1:1905] "Not applicable" "Not applicable" "Not applicable" "Not applicable" ...
FALSE  $ UNIT_MEASURE_label_fr : chr [1:1905] "individus" "nombre de décès pour 1 000 personnes" "pour mille" "individus" ...
FALSE  $ UNIT_MEASURE_label_en : chr [1:1905] "individuals" "number of deaths per 1,000 inhabitants" "per thousand" "individuals" ...
FALSE  $ CORRECTION_label_fr   : chr [1:1905] "Non corrigé" "Non corrigé" "Non corrigé" "Non corrigé" ...
FALSE  $ CORRECTION_label_en   : chr [1:1905] "Uncorrected" "Uncorrected" "Uncorrected" "Uncorrected" ...
FALSE  $ SERIE_ARRETEE_label_fr: chr [1:1905] "non" "non" "non" "non" ...
FALSE  $ SERIE_ARRETEE_label_en: chr [1:1905] "nO" "nO" "nO" "nO" ...</code></pre>
</div>
</div>
<p>Le résultat est un tibble comportant 1905 lignes et 39 colonnes. Il correspond en pratique aux 1905 séries chronologiques que l’on peut extraire de la base de données. Chaque série dispose d’un code unique contenu dans la variable <em>idbank</em>.</p>
</section>
<section id="extraction-dune-série-à-laide-de-son-identifiant" class="level3">
<h3 class="anchored" data-anchor-id="extraction-dune-série-à-laide-de-son-identifiant">Extraction d’une série à l’aide de son identifiant</h3>
<p>Une première solution pour extraire une série consiste à parcourir le tableau des variables jusqu’à repérer la ligne qui nous intéresse puis à noter son idbank et à extraire la série correspondante à l’aide de la fonction <strong>get_insee_idbank()</strong>. Par exemple, la première ligne du tableau des variables dont le code est “000436398” va renvoyer un tableau du taux brut de mortalité infantile en France métropolitaine de Janvier 1975 à Décembre 2014. On peut en faire rapidement un graphique avec la fonction <em>plot()</em> de R-Base</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>don<span class="ot">&lt;-</span><span class="fu">get_insee_idbank</span>(<span class="st">"000436398"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>FALSE 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>don<span class="ot">&lt;-</span>don[<span class="fu">order</span>(don<span class="sc">$</span>DATE),<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don<span class="sc">$</span>DATE,don<span class="sc">$</span>OBS_VALUE, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span><span class="st">"l"</span>, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">"red"</span>, </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Décès 0-1 ans pour  1000 naissances"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Données mensuelles"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Evolution de la mortalité infantile en France (1975-2014)"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">sub =</span> <span class="st">"Source : Insee"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="12-API-INSEE_files/figure-html/insee-id-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On remarque que la courbe a des oscillations saisonnières beaucoup moins fortes après 1995 ce qui est sans doute lié à un changement dans le mode de collecte des données plutôt qu’à la réalité.</p>
<p>On note aussi que les données s’arrêtent en 2014 ce qui est bizarre puisque l’API devrait nous donner les chiffres les plus récents. en fait les données plus récentes sont disponibles mais elles font partie d’une autre série de données.</p>
</section>
<section id="extraction-dun-ensemble-de-séries-dun-même-tableau" class="level3">
<h3 class="anchored" data-anchor-id="extraction-dun-ensemble-de-séries-dun-même-tableau">Extraction d’un ensemble de séries d’un même tableau</h3>
<p>Supposons que l’on veuille extraire trois courbes décrivant l’espérance de vie des hommes en France métropolitaine, à 20, 40 et 60 ans. Nous lançons alors une requête pour ne retenir dans le tableau des variables que les lignes qui nous intéressent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sel  <span class="ot">=</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_idbank_list</span>(<span class="st">"DECES-MORTALITE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SEXE <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FREQ <span class="sc">==</span> <span class="st">"A"</span>) <span class="sc">%&gt;%</span> <span class="co">#données annuelles</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(REF_AREA <span class="sc">==</span> <span class="st">"FM"</span>) <span class="sc">%&gt;%</span> <span class="co">#France métropolitaine</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DEMOGRAPHIE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ESPV-20"</span>,<span class="st">"ESPV-40"</span>,<span class="st">"ESPV-60"</span>)) <span class="co"># Espérance de vie</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(sel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 11%">
<col style="width: 0%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">nomflow</th>
<th style="text-align: left;">idbank</th>
<th style="text-align: left;">cleFlow</th>
<th style="text-align: left;">FREQ</th>
<th style="text-align: left;">INDICATEUR</th>
<th style="text-align: left;">NATURE</th>
<th style="text-align: left;">DEMOGRAPHIE</th>
<th style="text-align: left;">REF_AREA</th>
<th style="text-align: left;">SEXE</th>
<th style="text-align: left;">AGE</th>
<th style="text-align: left;">UNIT_MEASURE</th>
<th style="text-align: left;">CORRECTION</th>
<th style="text-align: left;">SERIE_ARRETEE</th>
<th style="text-align: left;">FREQ_label_fr</th>
<th style="text-align: left;">FREQ_label_en</th>
<th style="text-align: left;">INDICATEUR_label_fr</th>
<th style="text-align: left;">INDICATEUR_label_en</th>
<th style="text-align: left;">NATURE_label_fr</th>
<th style="text-align: left;">NATURE_label_en</th>
<th style="text-align: left;">DEMOGRAPHIE_label_fr</th>
<th style="text-align: left;">DEMOGRAPHIE_label_en</th>
<th style="text-align: left;">REF_AREA_label_fr</th>
<th style="text-align: left;">REF_AREA_label_en</th>
<th style="text-align: left;">SEXE_label_fr</th>
<th style="text-align: left;">SEXE_label_en</th>
<th style="text-align: left;">AGE_label_fr</th>
<th style="text-align: left;">AGE_label_en</th>
<th style="text-align: left;">UNIT_MEASURE_label_fr</th>
<th style="text-align: left;">UNIT_MEASURE_label_en</th>
<th style="text-align: left;">CORRECTION_label_fr</th>
<th style="text-align: left;">CORRECTION_label_en</th>
<th style="text-align: left;">SERIE_ARRETEE_label_fr</th>
<th style="text-align: left;">SERIE_ARRETEE_label_en</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">DECES-MORTALITE</td>
<td style="text-align: left;">001686948</td>
<td style="text-align: left;">A.ESPERANCE_VIE.VALEUR_ABSOLUE.ESPV-20.FM.1.SO.ANNEES.BRUT.FALSE</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">ESPERANCE_VIE</td>
<td style="text-align: left;">VALEUR_ABSOLUE</td>
<td style="text-align: left;">ESPV-20</td>
<td style="text-align: left;">FM</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">SO</td>
<td style="text-align: left;">ANNEES</td>
<td style="text-align: left;">BRUT</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">Annuelle</td>
<td style="text-align: left;">Annual</td>
<td style="text-align: left;">Espérance de vie</td>
<td style="text-align: left;">Life expectancy</td>
<td style="text-align: left;">Valeur absolue</td>
<td style="text-align: left;">Absolute value</td>
<td style="text-align: left;">Espérance de vie à 20 ans</td>
<td style="text-align: left;">Life expectancy at 20 years</td>
<td style="text-align: left;">France métropolitaine</td>
<td style="text-align: left;">Metropolitan France</td>
<td style="text-align: left;">Hommes</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">Sans objet</td>
<td style="text-align: left;">Not applicable</td>
<td style="text-align: left;">nombre d’années</td>
<td style="text-align: left;">number of years</td>
<td style="text-align: left;">Non corrigé</td>
<td style="text-align: left;">Uncorrected</td>
<td style="text-align: left;">non</td>
<td style="text-align: left;">nO</td>
</tr>
<tr class="even">
<td style="text-align: left;">DECES-MORTALITE</td>
<td style="text-align: left;">001686949</td>
<td style="text-align: left;">A.ESPERANCE_VIE.VALEUR_ABSOLUE.ESPV-40.FM.1.SO.ANNEES.BRUT.FALSE</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">ESPERANCE_VIE</td>
<td style="text-align: left;">VALEUR_ABSOLUE</td>
<td style="text-align: left;">ESPV-40</td>
<td style="text-align: left;">FM</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">SO</td>
<td style="text-align: left;">ANNEES</td>
<td style="text-align: left;">BRUT</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">Annuelle</td>
<td style="text-align: left;">Annual</td>
<td style="text-align: left;">Espérance de vie</td>
<td style="text-align: left;">Life expectancy</td>
<td style="text-align: left;">Valeur absolue</td>
<td style="text-align: left;">Absolute value</td>
<td style="text-align: left;">Espérance de vie à 40 ans</td>
<td style="text-align: left;">Life expectancy at 40 years</td>
<td style="text-align: left;">France métropolitaine</td>
<td style="text-align: left;">Metropolitan France</td>
<td style="text-align: left;">Hommes</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">Sans objet</td>
<td style="text-align: left;">Not applicable</td>
<td style="text-align: left;">nombre d’années</td>
<td style="text-align: left;">number of years</td>
<td style="text-align: left;">Non corrigé</td>
<td style="text-align: left;">Uncorrected</td>
<td style="text-align: left;">non</td>
<td style="text-align: left;">nO</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DECES-MORTALITE</td>
<td style="text-align: left;">001686950</td>
<td style="text-align: left;">A.ESPERANCE_VIE.VALEUR_ABSOLUE.ESPV-60.FM.1.SO.ANNEES.BRUT.FALSE</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">ESPERANCE_VIE</td>
<td style="text-align: left;">VALEUR_ABSOLUE</td>
<td style="text-align: left;">ESPV-60</td>
<td style="text-align: left;">FM</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">SO</td>
<td style="text-align: left;">ANNEES</td>
<td style="text-align: left;">BRUT</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">Annuelle</td>
<td style="text-align: left;">Annual</td>
<td style="text-align: left;">Espérance de vie</td>
<td style="text-align: left;">Life expectancy</td>
<td style="text-align: left;">Valeur absolue</td>
<td style="text-align: left;">Absolute value</td>
<td style="text-align: left;">Espérance de vie à 60 ans</td>
<td style="text-align: left;">Life expectancy at 60 years</td>
<td style="text-align: left;">France métropolitaine</td>
<td style="text-align: left;">Metropolitan France</td>
<td style="text-align: left;">Hommes</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">Sans objet</td>
<td style="text-align: left;">Not applicable</td>
<td style="text-align: left;">nombre d’années</td>
<td style="text-align: left;">number of years</td>
<td style="text-align: left;">Non corrigé</td>
<td style="text-align: left;">Uncorrected</td>
<td style="text-align: left;">non</td>
<td style="text-align: left;">nO</td>
</tr>
<tr class="even">
<td style="text-align: left;">DECES-MORTALITE</td>
<td style="text-align: left;">010536470</td>
<td style="text-align: left;">A.ESPERANCE_VIE.VALEUR_ABSOLUE.ESPV-20.FM.1.SO.ANNEES.BRUT.FALSE</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">ESPERANCE_VIE</td>
<td style="text-align: left;">VALEUR_ABSOLUE</td>
<td style="text-align: left;">ESPV-20</td>
<td style="text-align: left;">FM</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">SO</td>
<td style="text-align: left;">ANNEES</td>
<td style="text-align: left;">BRUT</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">Annuelle</td>
<td style="text-align: left;">Annual</td>
<td style="text-align: left;">Espérance de vie</td>
<td style="text-align: left;">Life expectancy</td>
<td style="text-align: left;">Valeur absolue</td>
<td style="text-align: left;">Absolute value</td>
<td style="text-align: left;">Espérance de vie à 20 ans</td>
<td style="text-align: left;">Life expectancy at 20 years</td>
<td style="text-align: left;">France métropolitaine</td>
<td style="text-align: left;">Metropolitan France</td>
<td style="text-align: left;">Hommes</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">Sans objet</td>
<td style="text-align: left;">Not applicable</td>
<td style="text-align: left;">nombre d’années</td>
<td style="text-align: left;">number of years</td>
<td style="text-align: left;">Non corrigé</td>
<td style="text-align: left;">Uncorrected</td>
<td style="text-align: left;">non</td>
<td style="text-align: left;">nO</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DECES-MORTALITE</td>
<td style="text-align: left;">010536474</td>
<td style="text-align: left;">A.ESPERANCE_VIE.VALEUR_ABSOLUE.ESPV-40.FM.1.SO.ANNEES.BRUT.FALSE</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">ESPERANCE_VIE</td>
<td style="text-align: left;">VALEUR_ABSOLUE</td>
<td style="text-align: left;">ESPV-40</td>
<td style="text-align: left;">FM</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">SO</td>
<td style="text-align: left;">ANNEES</td>
<td style="text-align: left;">BRUT</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">Annuelle</td>
<td style="text-align: left;">Annual</td>
<td style="text-align: left;">Espérance de vie</td>
<td style="text-align: left;">Life expectancy</td>
<td style="text-align: left;">Valeur absolue</td>
<td style="text-align: left;">Absolute value</td>
<td style="text-align: left;">Espérance de vie à 40 ans</td>
<td style="text-align: left;">Life expectancy at 40 years</td>
<td style="text-align: left;">France métropolitaine</td>
<td style="text-align: left;">Metropolitan France</td>
<td style="text-align: left;">Hommes</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">Sans objet</td>
<td style="text-align: left;">Not applicable</td>
<td style="text-align: left;">nombre d’années</td>
<td style="text-align: left;">number of years</td>
<td style="text-align: left;">Non corrigé</td>
<td style="text-align: left;">Uncorrected</td>
<td style="text-align: left;">non</td>
<td style="text-align: left;">nO</td>
</tr>
<tr class="even">
<td style="text-align: left;">DECES-MORTALITE</td>
<td style="text-align: left;">010536478</td>
<td style="text-align: left;">A.ESPERANCE_VIE.VALEUR_ABSOLUE.ESPV-60.FM.1.SO.ANNEES.BRUT.FALSE</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">ESPERANCE_VIE</td>
<td style="text-align: left;">VALEUR_ABSOLUE</td>
<td style="text-align: left;">ESPV-60</td>
<td style="text-align: left;">FM</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">SO</td>
<td style="text-align: left;">ANNEES</td>
<td style="text-align: left;">BRUT</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">Annuelle</td>
<td style="text-align: left;">Annual</td>
<td style="text-align: left;">Espérance de vie</td>
<td style="text-align: left;">Life expectancy</td>
<td style="text-align: left;">Valeur absolue</td>
<td style="text-align: left;">Absolute value</td>
<td style="text-align: left;">Espérance de vie à 60 ans</td>
<td style="text-align: left;">Life expectancy at 60 years</td>
<td style="text-align: left;">France métropolitaine</td>
<td style="text-align: left;">Metropolitan France</td>
<td style="text-align: left;">Hommes</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">Sans objet</td>
<td style="text-align: left;">Not applicable</td>
<td style="text-align: left;">nombre d’années</td>
<td style="text-align: left;">number of years</td>
<td style="text-align: left;">Non corrigé</td>
<td style="text-align: left;">Uncorrected</td>
<td style="text-align: left;">non</td>
<td style="text-align: left;">nO</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On découvre que le programme renvoie <strong>6 lignes au lieu de 3</strong>. Pourquoi ? Parce que l’INSEE stocke différemment des séries anciennes et des séries récentes. Il faut donc effectuer une requête sur les 4 codes à la fois pour avoir la série la plus longue.</p>
</section>
<section id="recupération-et-nettoyage-des-données" class="level3">
<h3 class="anchored" data-anchor-id="recupération-et-nettoyage-des-données">Recupération et nettoyage des données</h3>
<p>On récupère les données puis on procède à un petit nettoyage du tableau pour ne conserver que les colonnes utiles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>don <span class="ot">=</span> <span class="fu">get_insee_idbank</span>(sel<span class="sc">$</span>idbank)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>FALSE 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |===================================                                   |  51%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |===========================================================           |  84%
  |                                                                            
  |================================================================      |  92%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>don2<span class="ot">&lt;-</span>don <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">ANNEE =</span> DATE, <span class="at">ESPVIE=</span> OBS_VALUE, <span class="at">AGE =</span> TITLE_FR) <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">AGE =</span> <span class="fu">as.factor</span>(AGE)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">arrange</span>(AGE, ANNEE)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(don2<span class="sc">$</span>AGE) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"20 ans"</span>, <span class="st">"40 ans"</span>,<span class="st">"60 ans"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(don2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">ANNEE</th>
<th style="text-align: right;">ESPVIE</th>
<th style="text-align: left;">AGE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1946-01-01</td>
<td style="text-align: right;">48.0</td>
<td style="text-align: left;">20 ans</td>
</tr>
<tr class="even">
<td style="text-align: left;">1947-01-01</td>
<td style="text-align: right;">48.4</td>
<td style="text-align: left;">20 ans</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1948-01-01</td>
<td style="text-align: right;">48.5</td>
<td style="text-align: left;">20 ans</td>
</tr>
<tr class="even">
<td style="text-align: left;">1949-01-01</td>
<td style="text-align: right;">48.2</td>
<td style="text-align: left;">20 ans</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1950-01-01</td>
<td style="text-align: right;">48.7</td>
<td style="text-align: left;">20 ans</td>
</tr>
<tr class="even">
<td style="text-align: left;">1951-01-01</td>
<td style="text-align: right;">48.2</td>
<td style="text-align: left;">20 ans</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="construction-dun-graphique" class="level3">
<h3 class="anchored" data-anchor-id="construction-dun-graphique">Construction d’un graphique</h3>
<p>On peut maintenant construire notre graphique à l’aide par exemple de <code>ggplot2</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggplot</span>(don2) <span class="sc">+</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">aes</span>(<span class="at">x=</span>ANNEE,<span class="at">y=</span>ESPVIE, <span class="at">color =</span> AGE) <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="at">label=</span> <span class="st">"Espérance de vie en France Métropolitaine"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">subtitle =</span> <span class="st">"Source : INSEE"</span>)<span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_date</span>(<span class="st">"Données annuelles"</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="st">"Années de vie restantes"</span>,<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>))</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="12-API-INSEE_files/figure-html/insee-graph-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="discussion" class="level3">
<h3 class="anchored" data-anchor-id="discussion">Discussion</h3>
<p>Comme on peut le voir, l’utilisation d’un package simplifie l’usage des API mais ne dispense pas d’un apprentissage souvent long pour comprendre toutes les finesses du package (et parfois ses bugs …). Dans le cas du package INSEE, l’utilisation s’avère assez lourde mais permet d’accéder à un nombre considérable de données !</p>
</section>
</section>
<section id="exercices" class="level2">
<h2 class="anchored" data-anchor-id="exercices">Exercices</h2>
<section id="exercice-1-utilisation-du-package-insee" class="level3">
<h3 class="anchored" data-anchor-id="exercice-1-utilisation-du-package-insee">Exercice 1 : utilisation du package ‘insee’</h3>
<p>Construire à l’aide du package INSEE un graphique de l’évolution mensuelle de l’espérance de vie des femmes à la naissance en France Métropolitaine de 1945 à 2023.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>FALSE 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="cell-output-display">
<p><img src="12-API-INSEE_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>