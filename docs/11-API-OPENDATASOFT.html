<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Claude Grasland">

<title>DataMining2023 - L’API opendatasoft</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">DataMining2023</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./10-API-INTRO.html">Introduction aux API</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./11-API-OPENDATASOFT.html" aria-current="page">L’API opendatasoft</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./12-API-INSEE.html">L’API INSEE</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./20-CARTO-INTRO.html">CARTO-Intro</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./21-CARTO-sf.html">CARTO-sf</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./22-CARTO-mapsf.html">CARTO-mapsf</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#liste-des-api" id="toc-liste-des-api" class="nav-link active" data-scroll-target="#liste-des-api">Liste des API</a>
  <ul class="collapse">
  <li><a href="#en-parcourant-le-site" id="toc-en-parcourant-le-site" class="nav-link" data-scroll-target="#en-parcourant-le-site">En parcourant le site</a></li>
  <li><a href="#en-récupérant-le-catalogue" id="toc-en-récupérant-le-catalogue" class="nav-link" data-scroll-target="#en-récupérant-le-catalogue">En récupérant le catalogue</a></li>
  </ul></li>
  <li><a href="#liste-des-variables-dune-api" id="toc-liste-des-variables-dune-api" class="nav-link" data-scroll-target="#liste-des-variables-dune-api">Liste des variables d’une API</a>
  <ul class="collapse">
  <li><a href="#programme" id="toc-programme" class="nav-link" data-scroll-target="#programme">Programme</a></li>
  <li><a href="#fonction" id="toc-fonction" class="nav-link" data-scroll-target="#fonction">Fonction</a></li>
  </ul></li>
  <li><a href="#récupération-des-données" id="toc-récupération-des-données" class="nav-link" data-scroll-target="#récupération-des-données">Récupération des données</a>
  <ul class="collapse">
  <li><a href="#programme-1" id="toc-programme-1" class="nav-link" data-scroll-target="#programme-1">Programme</a></li>
  <li><a href="#fonction-1" id="toc-fonction-1" class="nav-link" data-scroll-target="#fonction-1">Fonction</a></li>
  </ul></li>
  <li><a href="#sélection-ou-exclusion" id="toc-sélection-ou-exclusion" class="nav-link" data-scroll-target="#sélection-ou-exclusion">Sélection ou exclusion</a>
  <ul class="collapse">
  <li><a href="#sélection" id="toc-sélection" class="nav-link" data-scroll-target="#sélection">Sélection</a></li>
  <li><a href="#exclusion" id="toc-exclusion" class="nav-link" data-scroll-target="#exclusion">Exclusion</a></li>
  <li><a href="#sélection-géographique" id="toc-sélection-géographique" class="nav-link" data-scroll-target="#sélection-géographique">Sélection géographique</a></li>
  <li><a href="#fonction-2" id="toc-fonction-2" class="nav-link" data-scroll-target="#fonction-2">Fonction</a></li>
  </ul></li>
  <li><a href="#exercice" id="toc-exercice" class="nav-link" data-scroll-target="#exercice">Exercice</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">L’API opendatasoft</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Claude Grasland </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<p>L’objectif de ce chapitre est d’examiner en détail le fonctionnement du site <strong>public.opendatasoft</strong> qui permet d’accèder à des centaines d’API à l’aide de requêtes normalisées. Sans apprendre en détail le fonctionnement de cette API, on va montrer comment créer de petites fonctions facilitant le travail d’exportation des variables ou des données.</p>
<p>On charge les packages utiles :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Les objets suivants sont masqués depuis 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Les objets suivants sont masqués depuis 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
</div>
<section id="liste-des-api" class="level2">
<h2 class="anchored" data-anchor-id="liste-des-api">Liste des API</h2>
<p>La première étape consiste à choisir l’API qui nous intéresse parmi plus de 600.</p>
<section id="en-parcourant-le-site" class="level3">
<h3 class="anchored" data-anchor-id="en-parcourant-le-site">En parcourant le site</h3>
<p>On peut se rendre sur le site pour parcourir les API proposées en allant à l’adresse : https://public.opendatasoft.com</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="img/opendatasoft.png" class="img-fluid" width="541"></p>
</div>
</div>
</section>
<section id="en-récupérant-le-catalogue" class="level3">
<h3 class="anchored" data-anchor-id="en-récupérant-le-catalogue">En récupérant le catalogue</h3>
<p>Mais il est également possible de téécharger le catalogue général … en se servant d’une API</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">GET</span>(<span class="st">'https://public.opendatasoft.com/api/datasets/1.0/search/?q=&amp;rows=1000&amp;start=0'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>y<span class="ot">&lt;-</span><span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>((x<span class="sc">$</span>content)))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>cat<span class="ot">&lt;-</span>y<span class="sc">$</span>datasets<span class="sc">$</span>metas</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(cat)<span class="ot">&lt;-</span>y<span class="sc">$</span>datasets<span class="sc">$</span>datasetid</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(cat[,<span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">1</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>)]),<span class="at">row.names =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 56%">
<col style="width: 2%">
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">keyword</th>
<th style="text-align: left;">domain</th>
<th style="text-align: left;">modified</th>
<th style="text-align: left;">license</th>
<th style="text-align: left;">publisher</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Actes budgétaires, Collectivité , M14 , M52 , M57</td>
<td style="text-align: left;">public</td>
<td style="text-align: left;">2019-03-06T10:33:30+00:00</td>
<td style="text-align: left;">Public domain</td>
<td style="text-align: left;">Direction Générale des Collectivités Locales (DGCL)</td>
</tr>
<tr class="even">
<td style="text-align: left;">provincie, kadaster</td>
<td style="text-align: left;">public</td>
<td style="text-align: left;">2021-10-20T07:54:50+00:00</td>
<td style="text-align: left;">CC 0 1.0</td>
<td style="text-align: left;">Opendatasoft</td>
</tr>
<tr class="odd">
<td style="text-align: left;">country , boundary , Natural Earth</td>
<td style="text-align: left;">public</td>
<td style="text-align: left;">2020-03-04T12:35:21+00:00</td>
<td style="text-align: left;">Public domain</td>
<td style="text-align: left;">Natural Earth</td>
</tr>
<tr class="even">
<td style="text-align: left;">nomenclature des actes budgétaires, collectivités locales , comptabilité , plan de comptes , Totem</td>
<td style="text-align: left;">public</td>
<td style="text-align: left;">2021-06-09T11:27:44+00:00</td>
<td style="text-align: left;">Open License v2.0</td>
<td style="text-align: left;">Direction Générale des Collectivités Locales (DGCL)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">subdistrict, nafa , nafot , county , department</td>
<td style="text-align: left;">public</td>
<td style="text-align: left;">2022-04-14T00:23:01+00:00</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Opendatasoft</td>
</tr>
<tr class="even">
<td style="text-align: left;">Production, déchets</td>
<td style="text-align: left;">public</td>
<td style="text-align: left;">2017-11-30T16:21:07+00:00</td>
<td style="text-align: left;">Open License v1.0</td>
<td style="text-align: left;">Ministère de l’Écologie, du Développement durable et de l’Énergie</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On suppose que le choix s’est porté sur l’API <em>arbresremarquablesparis2011</em></p>
<div class="cell">
<div class="cell-output-display">
<p><img src="img/arbres1.png" class="img-fluid" width="356"></p>
</div>
</div>
</section>
</section>
<section id="liste-des-variables-dune-api" class="level2">
<h2 class="anchored" data-anchor-id="liste-des-variables-dune-api">Liste des variables d’une API</h2>
<p>Avant de télécharger les données, on effectue une requête pour connaître les variables du tableau que l’on va télécharger ainsi que les variables pouvant servir de “facettes” c’est-à-dire permettant d’effectuer des requêtes.</p>
<section id="programme" class="level3">
<h3 class="anchored" data-anchor-id="programme">Programme</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>tab<span class="ot">&lt;-</span><span class="st">"arbresremarquablesparis2011"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>url<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">"https://public.opendatasoft.com/api/v2/catalog/datasets/"</span>,tab,<span class="st">"?"</span>,<span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">GET</span>(url)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>y<span class="ot">&lt;-</span><span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(x<span class="sc">$</span>content))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>var<span class="ot">&lt;-</span>y<span class="sc">$</span>dataset<span class="sc">$</span>fields</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             name           label   type annotations.facet
1          idbase          IDBASE double                NA
2 libellefrancais LIBELLEFRANCAIS   text              TRUE
3           genre           GENRE   text              TRUE
4          espece          ESPECE   text              TRUE
5         adresse         ADRESSE   text                NA
6 typeemplacement TYPEEMPLACEMENT   text                NA
  annotations.hierarchical annotations.unit annotations.facetsort
1                     &lt;NA&gt;             &lt;NA&gt;                  &lt;NA&gt;
2                     &lt;NA&gt;             &lt;NA&gt;                  &lt;NA&gt;
3                        /             &lt;NA&gt;                  &lt;NA&gt;
4                        /             &lt;NA&gt;                  &lt;NA&gt;
5                     &lt;NA&gt;             &lt;NA&gt;                  &lt;NA&gt;
6                     &lt;NA&gt;             &lt;NA&gt;                  &lt;NA&gt;
  annotations.timeserie_precision description
1                            &lt;NA&gt;          NA
2                            &lt;NA&gt;          NA
3                            &lt;NA&gt;          NA
4                            &lt;NA&gt;          NA
5                            &lt;NA&gt;          NA
6                            &lt;NA&gt;          NA</code></pre>
</div>
</div>
<p>Le tableau est correct, mais il présente une structure inhabituelle puisqu’on trouve un dataframe à l’intérieur de chaque ligne de la variable annotations. On va donc éviter les ennuis en ne gardant que les deux premières colonnes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> var  <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>annotations)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">label</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">idbase</td>
<td style="text-align: left;">IDBASE</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">libellefrancais</td>
<td style="text-align: left;">LIBELLEFRANCAIS</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">genre</td>
<td style="text-align: left;">GENRE</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">espece</td>
<td style="text-align: left;">ESPECE</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">adresse</td>
<td style="text-align: left;">ADRESSE</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">typeemplacement</td>
<td style="text-align: left;">TYPEEMPLACEMENT</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">domanialite</td>
<td style="text-align: left;">DOMANIALITE</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">arrondissement</td>
<td style="text-align: left;">ARRONDISSEMENT</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">complementadresse</td>
<td style="text-align: left;">COMPLEMENTADRESSE</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">numero</td>
<td style="text-align: left;">NUMERO</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">idemplacement</td>
<td style="text-align: left;">IDEMPLACEMENT</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">circonferenceencm</td>
<td style="text-align: left;">CIRCONFERENCE EN CM</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hauteurenm</td>
<td style="text-align: left;">HAUTEUR EN M</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">stadedeveloppement</td>
<td style="text-align: left;">STADEDEVELOPPEMENT</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pepiniere</td>
<td style="text-align: left;">PEPINIERE</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">varieteoucultivar</td>
<td style="text-align: left;">VARIETE OU CULTIVAR</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dateplantation</td>
<td style="text-align: left;">DATEPLANTATION</td>
<td style="text-align: left;">datetime</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">remarquable</td>
<td style="text-align: left;">REMARQUABLE</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geom_x_y</td>
<td style="text-align: left;">Geo point</td>
<td style="text-align: left;">geo_point_2d</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="fonction" class="level3">
<h3 class="anchored" data-anchor-id="fonction">Fonction</h3>
<p>On le transforme en fonction pour un usage plus simple :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>get_variables<span class="ot">&lt;-</span><span class="cf">function</span>(<span class="at">idtab =</span> <span class="st">"arbresremarquablesparis2011"</span>) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  url<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">"https://public.opendatasoft.com/api/v2/catalog/datasets/"</span>,idtab,<span class="st">"?"</span>,<span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  x<span class="ot">&lt;-</span><span class="fu">GET</span>(url)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  y<span class="ot">&lt;-</span><span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>((x<span class="sc">$</span>content)))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  var<span class="ot">&lt;-</span>y<span class="sc">$</span>dataset<span class="sc">$</span>fields</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> var <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>annotations)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(var)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut désormais appliquer notre fonction sur n’importe quel autre tableau du catalogue. Par exemple, si on choisit le tableau <code>qualite_de-lair-france</code> on obtient la liste de variables suivante :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>var<span class="ot">&lt;-</span><span class="fu">get_variables</span>(<span class="st">"qualite-de-lair-france"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">label</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">country</td>
<td style="text-align: left;">Country Code</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">city</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">location</td>
<td style="text-align: left;">Location</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">coordinates</td>
<td style="text-align: left;">Coordinates</td>
<td style="text-align: left;">geo_point_2d</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">measurements_parameter</td>
<td style="text-align: left;">Pollutant</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">measurements_sourcename</td>
<td style="text-align: left;">Source Name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">measurements_unit</td>
<td style="text-align: left;">Unit</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">measurements_value</td>
<td style="text-align: left;">Value</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">measurements_lastupdated</td>
<td style="text-align: left;">Last Updated</td>
<td style="text-align: left;">datetime</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">country_name_en</td>
<td style="text-align: left;">Country Label</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="récupération-des-données" class="level2">
<h2 class="anchored" data-anchor-id="récupération-des-données">Récupération des données</h2>
<section id="programme-1" class="level3">
<h3 class="anchored" data-anchor-id="programme-1">Programme</h3>
<p>Par défaut, une API renvoie 10 enregistrements, ce qui permet de se faire une première idée de la structure des données</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a> x<span class="ot">&lt;-</span><span class="fu">GET</span>(<span class="st">"https://public.opendatasoft.com/api/records/1.0/search/?dataset=arbresremarquablesparis2011&amp;q=&amp;rows=10"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>y<span class="ot">&lt;-</span><span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>((x<span class="sc">$</span>content)))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  don<span class="ot">&lt;-</span>y<span class="sc">$</span>records<span class="sc">$</span>fields</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(don)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 3%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 7%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 20%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">hauteurenm</th>
<th style="text-align: left;">geom_x_y</th>
<th style="text-align: right;">circonferenceencm</th>
<th style="text-align: left;">stadedeveloppement</th>
<th style="text-align: left;">remarquable</th>
<th style="text-align: left;">genre</th>
<th style="text-align: left;">pepiniere</th>
<th style="text-align: left;">dateplantation</th>
<th style="text-align: left;">typeemplacement</th>
<th style="text-align: left;">arrondissement</th>
<th style="text-align: left;">complementadresse</th>
<th style="text-align: left;">idemplacement</th>
<th style="text-align: left;">libellefrancais</th>
<th style="text-align: left;">domanialite</th>
<th style="text-align: left;">adresse</th>
<th style="text-align: left;">espece</th>
<th style="text-align: right;">idbase</th>
<th style="text-align: left;">varieteoucultivar</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">30</td>
<td style="text-align: left;">48.839405, 2.433374</td>
<td style="text-align: right;">310</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Liriodendron</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1862-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">BOIS DE VINCENNES</td>
<td style="text-align: left;">12-02</td>
<td style="text-align: left;">12-02</td>
<td style="text-align: left;">Tulipier</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">SQUARE CARNOT - AVENUE DAUMESNIL / ESPLANADE DU CHATEAU DE VINCENNES</td>
<td style="text-align: left;">tulipifera</td>
<td style="text-align: right;">2002370</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">22</td>
<td style="text-align: left;">48.868573, 2.313326</td>
<td style="text-align: right;">209</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Calocedrus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 8E ARRDT</td>
<td style="text-align: left;">Secteur Marigny</td>
<td style="text-align: left;">000103002</td>
<td style="text-align: left;">Libocèdre</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">JARDINS DES CHAMPS ELYSEES - SQUARE MARIGNY / 41 AVENUE GABRIEL</td>
<td style="text-align: left;">decurrens</td>
<td style="text-align: right;">307478</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">48.858754, 2.295499</td>
<td style="text-align: right;">205</td>
<td style="text-align: left;">Adulte</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Fagus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 7E ARRDT</td>
<td style="text-align: left;">Canton 03 / SETE</td>
<td style="text-align: left;">P00306006</td>
<td style="text-align: left;">Hêtre</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">JARDIN DU CHAMP DE MARS ET PELOUSES DE L ECOLE MILITAIRE / SETE</td>
<td style="text-align: left;">sylvatica</td>
<td style="text-align: right;">108183</td>
<td style="text-align: left;">‘’Pendula’’</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: left;">48.822604, 2.336701</td>
<td style="text-align: right;">400</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Fagus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 14E ARRDT</td>
<td style="text-align: left;">Grande pelouse</td>
<td style="text-align: left;">031302006</td>
<td style="text-align: left;">Hêtre</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">PARC MONTSOURIS / 28 BOULEVARD JOURDAN</td>
<td style="text-align: left;">sylvatica</td>
<td style="text-align: right;">113328</td>
<td style="text-align: left;">‘’Riversii’’</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12</td>
<td style="text-align: left;">48.847611, 2.253143</td>
<td style="text-align: right;">132</td>
<td style="text-align: left;">Adulte</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Firmiana</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 16E ARRDT</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">00030001</td>
<td style="text-align: left;">Sterculier</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">JARDIN DES SERRES D AUTEUIL / 1 AVENUE GORDON BENNETT</td>
<td style="text-align: left;">simplex</td>
<td style="text-align: right;">136446</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">13</td>
<td style="text-align: left;">48.857417, 2.314725</td>
<td style="text-align: right;">155</td>
<td style="text-align: left;">Adulte</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Magnolia</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 7E ARRDT</td>
<td style="text-align: left;">07-10</td>
<td style="text-align: left;">000202001</td>
<td style="text-align: left;">Magnolia</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">SQUARE D AJACCIO / 127 RUE DE GRENELLE</td>
<td style="text-align: left;">grandiflora</td>
<td style="text-align: right;">109016</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: left;">48.868295, 2.363189</td>
<td style="text-align: right;">53</td>
<td style="text-align: left;">Jeune (arbre)</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Quercus</td>
<td style="text-align: left;">GUILLOT BOURNE</td>
<td style="text-align: left;">2017-11-09T01:00:00+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 10E ARRDT</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">000401009</td>
<td style="text-align: left;">Chêne</td>
<td style="text-align: left;">Alignement</td>
<td style="text-align: left;">PLACE DE LA REPUBLIQUE</td>
<td style="text-align: left;">cerris</td>
<td style="text-align: right;">2017817</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">30</td>
<td style="text-align: left;">48.880335, 2.381305</td>
<td style="text-align: right;">725</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Platanus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 19E ARRDT</td>
<td style="text-align: left;">19-08</td>
<td style="text-align: left;">H0690012</td>
<td style="text-align: left;">Platane</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">PARC DES BUTTES CHAUMONT</td>
<td style="text-align: left;">x hispanica</td>
<td style="text-align: right;">102141</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">25</td>
<td style="text-align: left;">48.863391, 2.240481</td>
<td style="text-align: right;">468</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Cedrus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1862-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">BOIS DE BOULOGNE</td>
<td style="text-align: left;">16-09</td>
<td style="text-align: left;">000301002</td>
<td style="text-align: left;">Cèdre</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">GRANDE CASCADE - CARREFOUR DE LONGCHAMP</td>
<td style="text-align: left;">libani</td>
<td style="text-align: right;">2002348</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">31</td>
<td style="text-align: left;">48.87858, 2.30756</td>
<td style="text-align: right;">645</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Platanus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 8E ARRDT</td>
<td style="text-align: left;">08-02</td>
<td style="text-align: left;">00SO0222</td>
<td style="text-align: left;">Platane</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">PARC MONCEAU</td>
<td style="text-align: left;">orientalis</td>
<td style="text-align: right;">313940</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="fonction-1" class="level3">
<h3 class="anchored" data-anchor-id="fonction-1">Fonction</h3>
<p>On peut ensuite écrire une fonction qui précise le nombre d’enregistrements à lire avec le paramètre <code>raws=</code> et le point de départ de la lecture avec le paramètre <code>start=</code> (sachant que le premier enregistrement correspond à la valeur 0). On pourra ensuite procéder à des téléchargements successifs en évitant de dépasser la valeur <code>raws=10000</code> car en génral cela bloque le fonctionnement des API. Pour télécharger un tableau ayant plus de 10000 lignes, il faudra de préférence créer une boucle qui ramène des paquets de 10000.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>get_data<span class="ot">&lt;-</span><span class="cf">function</span>(<span class="at">idtab =</span> <span class="st">"arbresremarquablesparis2011"</span>,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">rows=</span><span class="dv">10</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start=</span><span class="dv">0</span>) {</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  url<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">"https://public.opendatasoft.com/api/records/1.0/search/?dataset="</span>,idtab,<span class="st">"&amp;q=&amp;rows="</span>,rows,<span class="st">"&amp;start="</span>,start,<span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  x<span class="ot">&lt;-</span><span class="fu">GET</span>(url)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  y<span class="ot">&lt;-</span><span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>((x<span class="sc">$</span>content)))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  don<span class="ot">&lt;-</span>y<span class="sc">$</span>records<span class="sc">$</span>fields</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(don)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dans le cas du tableau des arbres remarquables à paris, il n’y a que 178 enregistrements et il suffit donc de mettre une valeur de raws supérieure pour récupérer tout le tableau :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>don_arbres <span class="ot">&lt;-</span> <span class="fu">get_data</span>(<span class="at">idtab =</span> <span class="st">"arbresremarquablesparis2011"</span>,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rows=</span><span class="dv">1000</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">start=</span><span class="dv">0</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(don_arbres)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 174  18</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(don_arbres))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 7%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 20%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">hauteurenm</th>
<th style="text-align: left;">geom_x_y</th>
<th style="text-align: right;">circonferenceencm</th>
<th style="text-align: left;">stadedeveloppement</th>
<th style="text-align: left;">remarquable</th>
<th style="text-align: left;">genre</th>
<th style="text-align: left;">pepiniere</th>
<th style="text-align: left;">dateplantation</th>
<th style="text-align: left;">typeemplacement</th>
<th style="text-align: left;">arrondissement</th>
<th style="text-align: left;">complementadresse</th>
<th style="text-align: left;">idemplacement</th>
<th style="text-align: left;">libellefrancais</th>
<th style="text-align: left;">domanialite</th>
<th style="text-align: left;">adresse</th>
<th style="text-align: left;">espece</th>
<th style="text-align: right;">idbase</th>
<th style="text-align: left;">varieteoucultivar</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">30</td>
<td style="text-align: left;">48.839405, 2.433374</td>
<td style="text-align: right;">310</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Liriodendron</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1862-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">BOIS DE VINCENNES</td>
<td style="text-align: left;">12-02</td>
<td style="text-align: left;">12-02</td>
<td style="text-align: left;">Tulipier</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">SQUARE CARNOT - AVENUE DAUMESNIL / ESPLANADE DU CHATEAU DE VINCENNES</td>
<td style="text-align: left;">tulipifera</td>
<td style="text-align: right;">2002370</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">22</td>
<td style="text-align: left;">48.868573, 2.313326</td>
<td style="text-align: right;">209</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Calocedrus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 8E ARRDT</td>
<td style="text-align: left;">Secteur Marigny</td>
<td style="text-align: left;">000103002</td>
<td style="text-align: left;">Libocèdre</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">JARDINS DES CHAMPS ELYSEES - SQUARE MARIGNY / 41 AVENUE GABRIEL</td>
<td style="text-align: left;">decurrens</td>
<td style="text-align: right;">307478</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">48.858754, 2.295499</td>
<td style="text-align: right;">205</td>
<td style="text-align: left;">Adulte</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Fagus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 7E ARRDT</td>
<td style="text-align: left;">Canton 03 / SETE</td>
<td style="text-align: left;">P00306006</td>
<td style="text-align: left;">Hêtre</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">JARDIN DU CHAMP DE MARS ET PELOUSES DE L ECOLE MILITAIRE / SETE</td>
<td style="text-align: left;">sylvatica</td>
<td style="text-align: right;">108183</td>
<td style="text-align: left;">‘’Pendula’’</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: left;">48.822604, 2.336701</td>
<td style="text-align: right;">400</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Fagus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 14E ARRDT</td>
<td style="text-align: left;">Grande pelouse</td>
<td style="text-align: left;">031302006</td>
<td style="text-align: left;">Hêtre</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">PARC MONTSOURIS / 28 BOULEVARD JOURDAN</td>
<td style="text-align: left;">sylvatica</td>
<td style="text-align: right;">113328</td>
<td style="text-align: left;">‘’Riversii’’</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12</td>
<td style="text-align: left;">48.847611, 2.253143</td>
<td style="text-align: right;">132</td>
<td style="text-align: left;">Adulte</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Firmiana</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 16E ARRDT</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">00030001</td>
<td style="text-align: left;">Sterculier</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">JARDIN DES SERRES D AUTEUIL / 1 AVENUE GORDON BENNETT</td>
<td style="text-align: left;">simplex</td>
<td style="text-align: right;">136446</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">13</td>
<td style="text-align: left;">48.857417, 2.314725</td>
<td style="text-align: right;">155</td>
<td style="text-align: left;">Adulte</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Magnolia</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 7E ARRDT</td>
<td style="text-align: left;">07-10</td>
<td style="text-align: left;">000202001</td>
<td style="text-align: left;">Magnolia</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">SQUARE D AJACCIO / 127 RUE DE GRENELLE</td>
<td style="text-align: left;">grandiflora</td>
<td style="text-align: right;">109016</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Si l’on prend l’exemple de la qualité de l’air, le tableau est nettement plus grand mais reste sous la valeur de 10000 enregistrements</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>don_air <span class="ot">&lt;-</span> <span class="fu">get_data</span>(<span class="at">idtab =</span> <span class="st">"qualite-de-lair-france"</span>,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rows=</span><span class="dv">10000</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">start=</span><span class="dv">0</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(don_air)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1698   10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(don_air))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">measurements_unit</th>
<th style="text-align: right;">measurements_value</th>
<th style="text-align: left;">coordinates</th>
<th style="text-align: left;">measurements_sourcename</th>
<th style="text-align: left;">measurements_lastupdated</th>
<th style="text-align: left;">measurements_parameter</th>
<th style="text-align: left;">country_name_en</th>
<th style="text-align: left;">country</th>
<th style="text-align: left;">location</th>
<th style="text-align: left;">city</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">µg/m³</td>
<td style="text-align: right;">40.7</td>
<td style="text-align: left;">45.569452, 5.932986</td>
<td style="text-align: left;">EEA France</td>
<td style="text-align: left;">2023-03-17T01:00:00+00:00</td>
<td style="text-align: left;">NO2</td>
<td style="text-align: left;">France</td>
<td style="text-align: left;">FR</td>
<td style="text-align: left;">FR33105</td>
<td style="text-align: left;">Savoie</td>
</tr>
<tr class="even">
<td style="text-align: left;">µg/m³</td>
<td style="text-align: right;">99.3</td>
<td style="text-align: left;">45.420088, 4.395421</td>
<td style="text-align: left;">EEA France</td>
<td style="text-align: left;">2023-03-17T01:00:00+00:00</td>
<td style="text-align: left;">O3</td>
<td style="text-align: left;">France</td>
<td style="text-align: left;">FR</td>
<td style="text-align: left;">FR29424</td>
<td style="text-align: left;">Loire</td>
</tr>
<tr class="odd">
<td style="text-align: left;">µg/m³</td>
<td style="text-align: right;">5.6</td>
<td style="text-align: left;">45.774838, 4.898576</td>
<td style="text-align: left;">EEA France</td>
<td style="text-align: left;">2023-03-17T01:00:00+00:00</td>
<td style="text-align: left;">NO2</td>
<td style="text-align: left;">France</td>
<td style="text-align: left;">FR</td>
<td style="text-align: left;">FR20069</td>
<td style="text-align: left;">Rhône</td>
</tr>
<tr class="even">
<td style="text-align: left;">µg/m³</td>
<td style="text-align: right;">7.1</td>
<td style="text-align: left;">48.513488, -2.749527</td>
<td style="text-align: left;">EEA France</td>
<td style="text-align: left;">2023-03-16T20:00:00+00:00</td>
<td style="text-align: left;">PM2.5</td>
<td style="text-align: left;">France</td>
<td style="text-align: left;">FR</td>
<td style="text-align: left;">FR19061</td>
<td style="text-align: left;">Côtes-d’Armor</td>
</tr>
<tr class="odd">
<td style="text-align: left;">µg/m³</td>
<td style="text-align: right;">11.1</td>
<td style="text-align: left;">49.5027376, 0.2324858</td>
<td style="text-align: left;">EEA France</td>
<td style="text-align: left;">2023-03-17T01:00:00+00:00</td>
<td style="text-align: left;">PM10</td>
<td style="text-align: left;">France</td>
<td style="text-align: left;">FR</td>
<td style="text-align: left;">FR05083</td>
<td style="text-align: left;">Seine-Maritime</td>
</tr>
<tr class="even">
<td style="text-align: left;">µg/m³</td>
<td style="text-align: right;">13.2</td>
<td style="text-align: left;">47.247461, -1.936615</td>
<td style="text-align: left;">EEA France</td>
<td style="text-align: left;">2023-03-17T01:00:00+00:00</td>
<td style="text-align: left;">PM10</td>
<td style="text-align: left;">France</td>
<td style="text-align: left;">FR</td>
<td style="text-align: left;">FR23068</td>
<td style="text-align: left;">Loire-Atlantique</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Par contre la base SIRENE comporte 34 millions d’enregistrement et il va être impossible de la télécharger d’un coup à l’aide d’une API. Dès que la valeur rows dépasse 10000, l’API refuse de renvoyer les résultats</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>don_sir <span class="ot">&lt;-</span> <span class="fu">get_data</span>(<span class="at">idtab =</span> <span class="st">"sirene_v3"</span>,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rows=</span><span class="dv">10001</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">start=</span><span class="dv">0</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(don_sir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
</section>
</section>
<section id="sélection-ou-exclusion" class="level2">
<h2 class="anchored" data-anchor-id="sélection-ou-exclusion">Sélection ou exclusion</h2>
<p>L’intérêt principal d’une API est de procéder à des sélections d’enregistrement en amont de leur téléchargement. On va utiliser pour cela les facettes qui correspondent aux variables pour lesquelles l’API a prévu des index permettant une extraction rapide.</p>
<section id="sélection" class="level3">
<h3 class="anchored" data-anchor-id="sélection">Sélection</h3>
<p>Supposons par exemple qu’on ne veuille extraire que les arbres remarquables de la famille des chênes (genre = Quercus). Cela correspond à l’ajout à la fin de l’instruction GET d’une instruction <code>refine</code> prenant ici la forme <code>refine.genre=Quercus</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">"https://public.opendatasoft.com/api/records/1.0/search/?dataset=arbresremarquablesparis2011&amp;q=&amp;rows=100&amp;refine.genre=Quercus"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  y<span class="ot">&lt;-</span><span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>((x<span class="sc">$</span>content)))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  don<span class="ot">&lt;-</span>y<span class="sc">$</span>records<span class="sc">$</span>fields</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(don)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 8%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 19%">
<col style="width: 8%">
<col style="width: 2%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">hauteurenm</th>
<th style="text-align: left;">geom_x_y</th>
<th style="text-align: right;">circonferenceencm</th>
<th style="text-align: left;">stadedeveloppement</th>
<th style="text-align: left;">remarquable</th>
<th style="text-align: left;">genre</th>
<th style="text-align: left;">pepiniere</th>
<th style="text-align: left;">dateplantation</th>
<th style="text-align: left;">typeemplacement</th>
<th style="text-align: left;">arrondissement</th>
<th style="text-align: left;">idemplacement</th>
<th style="text-align: left;">libellefrancais</th>
<th style="text-align: left;">domanialite</th>
<th style="text-align: left;">adresse</th>
<th style="text-align: left;">espece</th>
<th style="text-align: right;">idbase</th>
<th style="text-align: left;">complementadresse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: left;">48.868295, 2.363189</td>
<td style="text-align: right;">53</td>
<td style="text-align: left;">Jeune (arbre)</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Quercus</td>
<td style="text-align: left;">GUILLOT BOURNE</td>
<td style="text-align: left;">2017-11-09T01:00:00+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 10E ARRDT</td>
<td style="text-align: left;">000401009</td>
<td style="text-align: left;">Chêne</td>
<td style="text-align: left;">Alignement</td>
<td style="text-align: left;">PLACE DE LA REPUBLIQUE</td>
<td style="text-align: left;">cerris</td>
<td style="text-align: right;">2017817</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">23</td>
<td style="text-align: left;">48.818389, 2.437919</td>
<td style="text-align: right;">255</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Quercus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1860-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">BOIS DE VINCENNES</td>
<td style="text-align: left;">12-15</td>
<td style="text-align: left;">Chêne</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">PENTE DE GRAVELLE - AVENUE DE GRAVELLE / ROUTE NOUVELLE</td>
<td style="text-align: left;">ilex</td>
<td style="text-align: right;">2002385</td>
<td style="text-align: left;">12-15</td>
</tr>
<tr class="odd">
<td style="text-align: right;">30</td>
<td style="text-align: left;">48.834174, 2.461321</td>
<td style="text-align: right;">431</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Quercus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1784-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">BOIS DE VINCENNES</td>
<td style="text-align: left;">12-25</td>
<td style="text-align: left;">Chêne</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">LAC DES MINIMES - ROUTE RONDE DES MINIMES</td>
<td style="text-align: left;">robur</td>
<td style="text-align: right;">2002376</td>
<td style="text-align: left;">12-25</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: left;">48.873681, 2.290252</td>
<td style="text-align: right;">207</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Quercus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 16E ARRDT</td>
<td style="text-align: left;">000206003</td>
<td style="text-align: left;">Chêne</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">JARDIN DE L AVENUE FOCH / 10 AVENUE FOCH</td>
<td style="text-align: left;">ilex</td>
<td style="text-align: right;">114867</td>
<td style="text-align: left;">PELOUSE 10 - 20 à 26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">30</td>
<td style="text-align: left;">48.843308, 2.449743</td>
<td style="text-align: right;">465</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Quercus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1815-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">BOIS DE VINCENNES</td>
<td style="text-align: left;">12-26</td>
<td style="text-align: left;">Chêne</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">FORT NEUF - AVENUE DE LA PEPINIERE / ROUTE DU GRAND MARECHAL</td>
<td style="text-align: left;">robur</td>
<td style="text-align: right;">2002375</td>
<td style="text-align: left;">12-26</td>
</tr>
<tr class="even">
<td style="text-align: right;">15</td>
<td style="text-align: left;">48.833021, 2.349918</td>
<td style="text-align: right;">140</td>
<td style="text-align: left;">Adulte</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Quercus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 13E ARRDT</td>
<td style="text-align: left;">000301002</td>
<td style="text-align: left;">Chêne</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">SQUARE RENE LE GALL / 1 RUE EMILE DESLANDRES</td>
<td style="text-align: left;">cerris</td>
<td style="text-align: right;">104839</td>
<td style="text-align: left;">Roseraie</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: left;">48.839644, 2.300976</td>
<td style="text-align: right;">180</td>
<td style="text-align: left;">Adulte</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Quercus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 15E ARRDT</td>
<td style="text-align: left;">000106001</td>
<td style="text-align: left;">Chêne</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">SQUARE DE LA PLACE ADOLPHE CHERIOUX / 260 RUE DE VAUGIRARD</td>
<td style="text-align: left;">frainetto</td>
<td style="text-align: right;">113597</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">11</td>
<td style="text-align: left;">48.847173, 2.252866</td>
<td style="text-align: right;">232</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Quercus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1895-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 16E ARRDT</td>
<td style="text-align: left;">00040054</td>
<td style="text-align: left;">Chêne</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">JARDIN DES SERRES D AUTEUIL / 1 AVENUE GORDON BENNETT</td>
<td style="text-align: left;">suber subsp. Occidentalis</td>
<td style="text-align: right;">136338</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: left;">48.84657, 2.25242</td>
<td style="text-align: right;">237</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Quercus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 16E ARRDT</td>
<td style="text-align: left;">00040039</td>
<td style="text-align: left;">Chêne</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">JARDIN DES SERRES D AUTEUIL / 1 AVENUE GORDON BENNETT</td>
<td style="text-align: left;">ilex</td>
<td style="text-align: right;">136323</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">15</td>
<td style="text-align: left;">48.821839, 2.335786</td>
<td style="text-align: right;">255</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Quercus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 14E ARRDT</td>
<td style="text-align: left;">0311B1011</td>
<td style="text-align: left;">Chêne</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">PARC MONTSOURIS / 28 BOULEVARD JOURDAN</td>
<td style="text-align: left;">ilex</td>
<td style="text-align: right;">110934</td>
<td style="text-align: left;">Volcan / Puits</td>
</tr>
<tr class="odd">
<td style="text-align: right;">14</td>
<td style="text-align: left;">48.838816, 2.406567</td>
<td style="text-align: right;">169</td>
<td style="text-align: left;">Adulte</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Quercus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1990-01-01T01:00:00+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 12E ARRDT</td>
<td style="text-align: left;">000202001</td>
<td style="text-align: left;">Chêne</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">SQUARE CHARLES PEGUY / 21 RUE ROTTEMBOURG</td>
<td style="text-align: left;">frainetto</td>
<td style="text-align: right;">123156</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="exclusion" class="level3">
<h3 class="anchored" data-anchor-id="exclusion">Exclusion</h3>
<p>On peut de la même manière exclure au lieu de sélectionner en utilisant l’instruction <code>exclude</code>. Par exemple, on peut retirer les deux bois de Vincennes et de Boulogne qui sont identifiés dans la variable arrondissement. Il ne rste plus alors que 130 arbres remarquables au lieu de 178.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">"https://public.opendatasoft.com/api/records/1.0/search/?dataset=arbresremarquablesparis2011&amp;q=&amp;rows=1000&amp;exclude.arrondissement=BOIS+DE+VINCENNES&amp;exclude.arrondissement=BOIS+DE+BOULOGNE"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  y<span class="ot">&lt;-</span><span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>((x<span class="sc">$</span>content)))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  don<span class="ot">&lt;-</span>y<span class="sc">$</span>records<span class="sc">$</span>fields</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">dim</span>(don)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 126  18</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">table</span>(don<span class="sc">$</span>arrondissement)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
PARIS 10E ARRDT PARIS 11E ARRDT PARIS 12E ARRDT PARIS 13E ARRDT PARIS 14E ARRDT 
              1               1               3               4              10 
PARIS 15E ARRDT PARIS 16E ARRDT PARIS 17E ARRDT PARIS 18E ARRDT PARIS 19E ARRDT 
              6              27               8              10              10 
PARIS 1ER ARRDT PARIS 20E ARRDT  PARIS 3E ARRDT  PARIS 4E ARRDT  PARIS 5E ARRDT 
              1              14               3               5               6 
 PARIS 6E ARRDT  PARIS 7E ARRDT  PARIS 8E ARRDT  PARIS 9E ARRDT 
              1               9               5               2 </code></pre>
</div>
</div>
</section>
<section id="sélection-géographique" class="level3">
<h3 class="anchored" data-anchor-id="sélection-géographique">Sélection géographique</h3>
<p>Une autre possibilité offerte par l’application est d’extraire des enregistrements en fonction d’une localisation géographique et d’une distance maximale à celle-ci. Supposons par exemple que l’on souhaite trouver l’ensemble des arbres remarquables dans un rayon de 2 km autour du bâtiment Olympe de Gouges situé place Paul Ricoeur dans le 13e arrondissement. Pour résoudre le problème, on commence par déterminer les coordonnées du lieu cible ce qui peut se faire par un click droit dans une Google Map :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"img/coord_odg.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="img/coord_odg.png" class="img-fluid" width="638"></p>
</div>
</div>
<p>On passe ensuite une requête incluant le paramètre <code>geofilter.distance()</code>assortie des trois paramètres de latitude (en degré décimal), longitude (en degré décimal) et distance (en mètres) avec comme séparateur <code>%2C</code>ce qui donne au final un tableau ne comportant que 3 arbres remarquables à moins de deux kilomètres du point choisi :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">GET</span>(<span class="st">"https://public.opendatasoft.com/api/records/1.0/search/?dataset=arbresremarquablesparis2011&amp;q=&amp;rows=1000&amp;geofilter.distance=48.82670%2C2.38242%2C2000"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  y<span class="ot">&lt;-</span><span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>((x<span class="sc">$</span>content)))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  don<span class="ot">&lt;-</span>y<span class="sc">$</span>records<span class="sc">$</span>fields</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>don <span class="ot">&lt;-</span>don<span class="sc">%&gt;%</span> <span class="fu">select</span>(adresse, libellefrancais, dist, hauteurenm, circonferenceencm)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(don)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 51%">
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">adresse</th>
<th style="text-align: left;">libellefrancais</th>
<th style="text-align: left;">dist</th>
<th style="text-align: right;">hauteurenm</th>
<th style="text-align: right;">circonferenceencm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PARC DE BERCY / 128 QUAI DE BERCY</td>
<td style="text-align: left;">Platane</td>
<td style="text-align: left;">829.84776688445</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">502</td>
</tr>
<tr class="even">
<td style="text-align: left;">PARC DE CHOISY / 1 RUE GEORGE EASTMAN</td>
<td style="text-align: left;">Cèdre</td>
<td style="text-align: left;">1699.294305054727</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">355</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JARDIN DE LA GARE DE REUILLY - JULIEN LAUPRETRE / 6 RUE PAUL DUKAS</td>
<td style="text-align: left;">Libocèdre</td>
<td style="text-align: left;">1728.7655425984415</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">205</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="fonction-2" class="level3">
<h3 class="anchored" data-anchor-id="fonction-2">Fonction</h3>
<p>Nous pouvons alors créer une petite fonction qui va automatiquement sélectionner les arbres en fonction d’une coordonnée et d’une distance choisies par l’utilisateur :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>get_data_geo<span class="ot">&lt;-</span>donnees<span class="ot">&lt;-</span><span class="cf">function</span>(<span class="at">idtab =</span> <span class="st">"arbresremarquablesparis2011"</span>,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">rows=</span><span class="dv">10</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start=</span><span class="dv">0</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lat =</span> <span class="fl">48.82670</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lon =</span> <span class="fl">2.38242</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dist =</span> <span class="dv">2000</span>) {</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  url<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">"https://public.opendatasoft.com/api/records/1.0/search/?dataset="</span>,idtab,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">"&amp;q=&amp;rows="</span>,rows,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">"&amp;start="</span>,start,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">"&amp;geofilter.distance="</span>, lat,<span class="st">"%2C"</span>, lon,<span class="st">"%2C"</span>,dist,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  x<span class="ot">&lt;-</span><span class="fu">GET</span>(url)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  y<span class="ot">&lt;-</span><span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>((x<span class="sc">$</span>content)))</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  don<span class="ot">&lt;-</span>y<span class="sc">$</span>records<span class="sc">$</span>fields</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(don)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notre fonction est paramétrée par défaut sur la place Paul Ricoeur pour un rayon de 2000 mètres mais on peut ensuite changer les paramètres comme on le souhaite. On peut par exemple rechercher les arbres remarquables dans un rayon de 500 mètres autour de la cathédrale Notre Dame de Paris.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>tab<span class="ot">&lt;-</span><span class="fu">get_data_geo</span>(<span class="at">idtab =</span> <span class="st">"arbresremarquablesparis2011"</span>,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">rows=</span><span class="dv">1000</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start=</span><span class="dv">0</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lat =</span> <span class="fl">48.85331</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lon =</span> <span class="fl">2.34907</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dist =</span> <span class="dv">500</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 7%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 15%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 5%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">hauteurenm</th>
<th style="text-align: left;">geom_x_y</th>
<th style="text-align: right;">circonferenceencm</th>
<th style="text-align: left;">stadedeveloppement</th>
<th style="text-align: left;">remarquable</th>
<th style="text-align: left;">genre</th>
<th style="text-align: left;">pepiniere</th>
<th style="text-align: left;">dateplantation</th>
<th style="text-align: left;">typeemplacement</th>
<th style="text-align: left;">arrondissement</th>
<th style="text-align: left;">complementadresse</th>
<th style="text-align: left;">idemplacement</th>
<th style="text-align: left;">libellefrancais</th>
<th style="text-align: left;">domanialite</th>
<th style="text-align: left;">adresse</th>
<th style="text-align: left;">espece</th>
<th style="text-align: right;">idbase</th>
<th style="text-align: left;">dist</th>
<th style="text-align: left;">varieteoucultivar</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: left;">48.852783, 2.351016</td>
<td style="text-align: right;">210</td>
<td style="text-align: left;">Adulte</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Corylus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 4E ARRDT</td>
<td style="text-align: left;">04-04</td>
<td style="text-align: left;">000104001</td>
<td style="text-align: left;">Noisetier de Byzance</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">SQUARE JEAN XXIII / 2 QUAI DE L ARCHEVECHE</td>
<td style="text-align: left;">colurna</td>
<td style="text-align: right;">125046</td>
<td style="text-align: left;">153.9816687873372</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: left;">48.852191, 2.347286</td>
<td style="text-align: right;">365</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Robinia</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1602-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 5E ARRDT</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">000401001</td>
<td style="text-align: left;">Robinier</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">SQUARE RENE VIVIANI MONTEBELLO / 2 RUE DU FOUARRE</td>
<td style="text-align: left;">pseudoacacia</td>
<td style="text-align: right;">124358</td>
<td style="text-align: left;">180.29215072419555</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">48.852102, 2.350804</td>
<td style="text-align: right;">167</td>
<td style="text-align: left;">Adulte</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Ulmus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 4E ARRDT</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">000302002</td>
<td style="text-align: left;">Orme</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">SQUARE JEAN XXIII / 2 QUAI DE L ARCHEVECHE</td>
<td style="text-align: left;">glabra</td>
<td style="text-align: right;">125063</td>
<td style="text-align: left;">184.75764884140503</td>
<td style="text-align: left;">‘’Pendula’’</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">48.85235, 2.35181</td>
<td style="text-align: right;">230</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Tamarix</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 4E ARRDT</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">000102002</td>
<td style="text-align: left;">Tamaris</td>
<td style="text-align: left;">Jardin</td>
<td style="text-align: left;">SQUARE JEAN XXIII / 2 QUAI DE L ARCHEVECHE</td>
<td style="text-align: left;">n.&nbsp;sp.</td>
<td style="text-align: right;">125051</td>
<td style="text-align: left;">226.86413517666327</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">16</td>
<td style="text-align: left;">48.855760, 2.353992</td>
<td style="text-align: right;">190</td>
<td style="text-align: left;">Mature</td>
<td style="text-align: left;">OUI</td>
<td style="text-align: left;">Ulmus</td>
<td style="text-align: left;">Inconnue</td>
<td style="text-align: left;">1700-01-01T00:09:21+00:00</td>
<td style="text-align: left;">Arbre</td>
<td style="text-align: left;">PARIS 4E ARRDT</td>
<td style="text-align: left;">04-01</td>
<td style="text-align: left;">000301001</td>
<td style="text-align: left;">Orme</td>
<td style="text-align: left;">Alignement</td>
<td style="text-align: left;">PLACE SAINT GERVAIS</td>
<td style="text-align: left;">minor</td>
<td style="text-align: right;">267663</td>
<td style="text-align: left;">451.4910432410224</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Mais notre fonction peut également marcher pour d’autres tableaux si ceux-ci ont la même structure. On peut ainsi examiner les entreprises localisées à moins de 50 mètres du bâtiment d’Olympe de Gouges à l’aide de la base SIREN et on trouve 11 références :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>tab<span class="ot">&lt;-</span><span class="fu">get_data_geo</span>(<span class="at">idtab =</span> <span class="st">"sirene_v3"</span>,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">rows=</span><span class="dv">1000</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start=</span><span class="dv">0</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lat =</span> <span class="fl">48.82670</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lon =</span> <span class="fl">2.38242</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dist =</span> <span class="dv">50</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>tab<span class="ot">&lt;-</span>tab <span class="sc">%&gt;%</span> <span class="fu">select</span>(siret,l1_adressage_unitelegale, adresseetablissement,sectionetablissement,naturejuridiqueunitelegale)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 6%">
<col style="width: 26%">
<col style="width: 11%">
<col style="width: 21%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">siret</th>
<th style="text-align: left;">l1_adressage_unitelegale</th>
<th style="text-align: left;">adresseetablissement</th>
<th style="text-align: left;">sectionetablissement</th>
<th style="text-align: left;">naturejuridiqueunitelegale</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">84261103000011</td>
<td style="text-align: left;">ELIPS (ETUDIANTS DE LINGUISTIQUE INFORMATIQUE DE PARIS DIDEROT)</td>
<td style="text-align: left;">8 PL PAUL RICOEUR</td>
<td style="text-align: left;">Autres activites de services</td>
<td style="text-align: left;">Association déclarée</td>
</tr>
<tr class="even">
<td style="text-align: left;">87776849900015</td>
<td style="text-align: left;">GEOMIE</td>
<td style="text-align: left;">PL PAUL RICOEUR</td>
<td style="text-align: left;">Autres activites de services</td>
<td style="text-align: left;">Association déclarée</td>
</tr>
<tr class="odd">
<td style="text-align: left;">18750006101539</td>
<td style="text-align: left;">CENTRE REGIONAL OEUVRES UNIV SCOLAIRES</td>
<td style="text-align: left;">8 PL PAUL RICOEUR</td>
<td style="text-align: left;">Hebergement et restauration</td>
<td style="text-align: left;">Autre établissement public national administratif à compétence territoriale limitée</td>
</tr>
<tr class="even">
<td style="text-align: left;">90059716200016</td>
<td style="text-align: left;">INGENIEURS SANS FRONTIERES, EQUIPE DE L’UNIVERSITE DE PARIS</td>
<td style="text-align: left;">8 PL PAUL RICOEUR</td>
<td style="text-align: left;">Autres activites de services</td>
<td style="text-align: left;">Association déclarée</td>
</tr>
<tr class="odd">
<td style="text-align: left;">82868797000016</td>
<td style="text-align: left;">JUNIOR EIDD CONSEIL</td>
<td style="text-align: left;">8 PL PAUL RICOEUR</td>
<td style="text-align: left;">Activites specialisees, scientifiques et techniques</td>
<td style="text-align: left;">Association déclarée</td>
</tr>
<tr class="even">
<td style="text-align: left;">78887970800014</td>
<td style="text-align: left;">SIMULAUTO</td>
<td style="text-align: left;">9 RUE ALBERT EINSTEIN</td>
<td style="text-align: left;">Enseignement</td>
<td style="text-align: left;">SAS, société par actions simplifiée</td>
</tr>
<tr class="odd">
<td style="text-align: left;">79378675700013</td>
<td style="text-align: left;">PARIS PERMIS</td>
<td style="text-align: left;">9 RUE ALBERT EINSTEIN</td>
<td style="text-align: left;">Enseignement</td>
<td style="text-align: left;">Société à responsabilité limitée (sans autre indication)</td>
</tr>
<tr class="even">
<td style="text-align: left;">87973678300017</td>
<td style="text-align: left;">Madame HELENE DUPLANTIER</td>
<td style="text-align: left;">7 RUE ALBERT EINSTEIN</td>
<td style="text-align: left;">Arts, spectacles et activites recreatives</td>
<td style="text-align: left;">Entrepreneur individuel</td>
</tr>
<tr class="odd">
<td style="text-align: left;">84262529500014</td>
<td style="text-align: left;">Madame JOANA FONSECA LEITAO</td>
<td style="text-align: left;">7 RUE ALBERT EINSTEIN</td>
<td style="text-align: left;">Activites de services administratifs et de soutien</td>
<td style="text-align: left;">Entrepreneur individuel</td>
</tr>
<tr class="even">
<td style="text-align: left;">81325823300028</td>
<td style="text-align: left;">COMPAGNIE LES ENVOLEES</td>
<td style="text-align: left;">7 RUE ALBERT EINSTEIN</td>
<td style="text-align: left;">Arts, spectacles et activites recreatives</td>
<td style="text-align: left;">Association déclarée</td>
</tr>
<tr class="odd">
<td style="text-align: left;">88086923500015</td>
<td style="text-align: left;">STREET BIDA</td>
<td style="text-align: left;">1 RUE NICOLE REINE LEPAUTE</td>
<td style="text-align: left;">Hebergement et restauration</td>
<td style="text-align: left;">SAS, société par actions simplifiée</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="exercice" class="level2">
<h2 class="anchored" data-anchor-id="exercice">Exercice</h2>
<p>Essayez de récupérer les informations sur l’ensemble des ventes immobilières de maisons commune de Montcuq-en-Quercy-Blanc (Code Postal 46800) au cours de l’année 2020 puis calculés le prix moyen par m2 de</p>
<p><strong>buildingref-france-demande-de-valeurs-foncieres-geolocalisee-millesime</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a> x<span class="ot">&lt;-</span><span class="fu">GET</span>(<span class="st">"https://public.opendatasoft.com/api/records/1.0/search/?dataset=buildingref-france-demande-de-valeurs-foncieres-geolocalisee-millesime&amp;q=montcuq&amp;refine.date_mutation=2020&amp;refine.type_local=Maison&amp;rows=1000"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>w<span class="ot">&lt;-</span><span class="fu">rawToChar</span>((x<span class="sc">$</span>content))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>d<span class="ot">&lt;-</span><span class="fu">fromJSON</span>(w)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>t<span class="ot">&lt;-</span>d<span class="sc">$</span>records<span class="sc">$</span>fields</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>don<span class="ot">&lt;-</span>t <span class="sc">%&gt;%</span> <span class="fu">select</span>(surface_reelle_bati,surface_terrain,valeur_fonciere) <span class="sc">%&gt;%</span> </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prixm2 =</span> valeur_fonciere<span class="sc">/</span>surface_reelle_bati)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(don)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">surface_reelle_bati</th>
<th style="text-align: right;">surface_terrain</th>
<th style="text-align: right;">valeur_fonciere</th>
<th style="text-align: right;">prixm2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">60</td>
<td style="text-align: right;">1258</td>
<td style="text-align: right;">60000</td>
<td style="text-align: right;">1000.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">140</td>
<td style="text-align: right;">1205</td>
<td style="text-align: right;">160000</td>
<td style="text-align: right;">1142.8571</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100</td>
<td style="text-align: right;">932</td>
<td style="text-align: right;">150000</td>
<td style="text-align: right;">1500.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">102</td>
<td style="text-align: right;">910</td>
<td style="text-align: right;">238000</td>
<td style="text-align: right;">2333.3333</td>
</tr>
<tr class="odd">
<td style="text-align: right;">50</td>
<td style="text-align: right;">800</td>
<td style="text-align: right;">121000</td>
<td style="text-align: right;">2420.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">159</td>
<td style="text-align: right;">367</td>
<td style="text-align: right;">330000</td>
<td style="text-align: right;">2075.4717</td>
</tr>
<tr class="odd">
<td style="text-align: right;">50</td>
<td style="text-align: right;">443</td>
<td style="text-align: right;">190150</td>
<td style="text-align: right;">3803.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">137</td>
<td style="text-align: right;">5566</td>
<td style="text-align: right;">165000</td>
<td style="text-align: right;">1204.3796</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">45000</td>
<td style="text-align: right;">450.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">280</td>
<td style="text-align: right;">450</td>
<td style="text-align: right;">270000</td>
<td style="text-align: right;">964.2857</td>
</tr>
<tr class="odd">
<td style="text-align: right;">81</td>
<td style="text-align: right;">1579</td>
<td style="text-align: right;">146000</td>
<td style="text-align: right;">1802.4691</td>
</tr>
<tr class="even">
<td style="text-align: right;">148</td>
<td style="text-align: right;">425</td>
<td style="text-align: right;">278000</td>
<td style="text-align: right;">1878.3784</td>
</tr>
<tr class="odd">
<td style="text-align: right;">71</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">110000</td>
<td style="text-align: right;">1549.2958</td>
</tr>
<tr class="even">
<td style="text-align: right;">70</td>
<td style="text-align: right;">137</td>
<td style="text-align: right;">41800</td>
<td style="text-align: right;">597.1429</td>
</tr>
<tr class="odd">
<td style="text-align: right;">148</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">278000</td>
<td style="text-align: right;">1878.3784</td>
</tr>
<tr class="even">
<td style="text-align: right;">99</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">225000</td>
<td style="text-align: right;">2272.7273</td>
</tr>
<tr class="odd">
<td style="text-align: right;">99</td>
<td style="text-align: right;">2460</td>
<td style="text-align: right;">225000</td>
<td style="text-align: right;">2272.7273</td>
</tr>
<tr class="even">
<td style="text-align: right;">140</td>
<td style="text-align: right;">1118</td>
<td style="text-align: right;">370000</td>
<td style="text-align: right;">2642.8571</td>
</tr>
<tr class="odd">
<td style="text-align: right;">140</td>
<td style="text-align: right;">610</td>
<td style="text-align: right;">370000</td>
<td style="text-align: right;">2642.8571</td>
</tr>
<tr class="even">
<td style="text-align: right;">77</td>
<td style="text-align: right;">739</td>
<td style="text-align: right;">107000</td>
<td style="text-align: right;">1389.6104</td>
</tr>
<tr class="odd">
<td style="text-align: right;">134</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">130000</td>
<td style="text-align: right;">970.1493</td>
</tr>
<tr class="even">
<td style="text-align: right;">64</td>
<td style="text-align: right;">957</td>
<td style="text-align: right;">103000</td>
<td style="text-align: right;">1609.3750</td>
</tr>
<tr class="odd">
<td style="text-align: right;">55</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">217250</td>
<td style="text-align: right;">3950.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">100</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">150000</td>
<td style="text-align: right;">1500.0000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">200</td>
<td style="text-align: right;">1060</td>
<td style="text-align: right;">225000</td>
<td style="text-align: right;">1125.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">75</td>
<td style="text-align: right;">1827</td>
<td style="text-align: right;">106177</td>
<td style="text-align: right;">1415.6933</td>
</tr>
<tr class="odd">
<td style="text-align: right;">27</td>
<td style="text-align: right;">1275</td>
<td style="text-align: right;">187000</td>
<td style="text-align: right;">6925.9259</td>
</tr>
<tr class="even">
<td style="text-align: right;">150</td>
<td style="text-align: right;">327</td>
<td style="text-align: right;">300000</td>
<td style="text-align: right;">2000.0000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">163</td>
<td style="text-align: right;">225</td>
<td style="text-align: right;">222000</td>
<td style="text-align: right;">1361.9632</td>
</tr>
<tr class="even">
<td style="text-align: right;">70</td>
<td style="text-align: right;">358</td>
<td style="text-align: right;">82000</td>
<td style="text-align: right;">1171.4286</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">41800</td>
<td style="text-align: right;">2090.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">79</td>
<td style="text-align: right;">1275</td>
<td style="text-align: right;">187000</td>
<td style="text-align: right;">2367.0886</td>
</tr>
<tr class="odd">
<td style="text-align: right;">95</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">217250</td>
<td style="text-align: right;">2286.8421</td>
</tr>
<tr class="even">
<td style="text-align: right;">324</td>
<td style="text-align: right;">234</td>
<td style="text-align: right;">510000</td>
<td style="text-align: right;">1574.0741</td>
</tr>
<tr class="odd">
<td style="text-align: right;">220</td>
<td style="text-align: right;">1210</td>
<td style="text-align: right;">335000</td>
<td style="text-align: right;">1522.7273</td>
</tr>
<tr class="even">
<td style="text-align: right;">40</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">18000</td>
<td style="text-align: right;">450.0000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">140</td>
<td style="text-align: right;">2080</td>
<td style="text-align: right;">370000</td>
<td style="text-align: right;">2642.8571</td>
</tr>
<tr class="even">
<td style="text-align: right;">210</td>
<td style="text-align: right;">170</td>
<td style="text-align: right;">535240</td>
<td style="text-align: right;">2548.7619</td>
</tr>
<tr class="odd">
<td style="text-align: right;">70</td>
<td style="text-align: right;">271</td>
<td style="text-align: right;">82000</td>
<td style="text-align: right;">1171.4286</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(don)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> surface_reelle_bati surface_terrain  valeur_fonciere      prixm2    
 Min.   : 20.0       Min.   :  31.0   Min.   : 18000   Min.   : 450  
 1st Qu.: 70.0       1st Qu.: 243.2   1st Qu.:108500   1st Qu.:1188  
 Median :100.0       Median : 500.0   Median :187000   Median :1609  
 Mean   :115.1       Mean   : 842.0   Mean   :202530   Mean   :1910  
 3rd Qu.:144.0       3rd Qu.:1183.2   3rd Qu.:274000   3rd Qu.:2310  
 Max.   :324.0       Max.   :5566.0   Max.   :535240   Max.   :6926  
                     NA's   :1                                       </code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don<span class="sc">$</span>surface_reelle_bati,don<span class="sc">$</span>valeur_fonciere)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="11-API-OPENDATASOFT_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>